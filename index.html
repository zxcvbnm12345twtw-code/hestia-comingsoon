<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <link rel="icon" href="/favicon.png" type="image/png" sizes="32x32" />
  <link rel="icon" href="/favicon.png" type="image/png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/favicon.png" />

  <title>HESTIA TAIWAN｜喚醒內在色溫</title>
  <meta name="description" content="HESTIA 健身時尚品牌，融合時尚與力量優雅，讓每個人穿出屬於自己的火焰。Own Your Flame.">
  <meta name="keywords" content="Hestia, 健身, 健身時尚服飾, 運動休閒服飾, 台灣品牌">
  <meta property="og:title" content="HESTIA TAIWAN｜健身時尚品牌">
  <meta property="og:description" content="Own Your Flame. 不只是運動，更是自我認同。">
  <meta property="og:url" content="https://www.hestiatw.com/">
  <meta property="og:type" content="website">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@200..900&display=swap">

  <style>
    /* =========================================
       THEME ENGINE: INNER COLOR TEMPERATURE
       (移植自參考範例的 HSL 系統)
       ========================================= */
    :root {
      /* 預設色溫 (Cool/Neutral) */
      --hue-core: 210; 
      --sat-core: 80%;
      --light-core: 50%;

      /* 衍生色系 */
      --color-ether-primary: hsl(var(--hue-core), var(--sat-core), 96%);
      --color-ether-secondary: hsl(var(--hue-core), 40%, 70%);
      --color-ether-glow: hsl(var(--hue-core), 100%, 70%);
      --color-void: hsl(var(--hue-core), 30%, 5%); /* 深色背景 */

      /* 玻璃擬態參數 */
      --glass-bg: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-blur: 20px;
      --glass-shadow: 0 15px 40px rgba(0,0,0,0.4);

      /* 呼吸節奏 */
      --breath-cycle: 8s;

      /* UI 變數映射到舊結構 */
      --text: var(--color-ether-primary);
      --muted: var(--color-ether-secondary);
      --accent: var(--color-ether-glow);
      
      --wrap: 760px;
      --font-primary: "Inter", -apple-system, sans-serif;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0; padding: 0; overflow-x: hidden;
      background: var(--color-void);
      color: var(--text);
      font-family: var(--font-primary);
      height: 100%;
    }

    body {
      transition: background-color 1.5s cubic-bezier(0.25, 1, 0.5, 1), color 1s ease;
    }

    /* =========================================
       DYNAMIC COLOR MAPPING (將原本的 HEX 改為 HSL 驅動)
       ========================================= */
    
    /* 預設狀態 */
    body:not([data-precolor]), body[data-precolor="black"] { --hue-core: 220; --sat-core: 0%; }
    
    /* Pre-tone 對應 */
    body[data-precolor="red"]    { --hue-core: 350; --sat-core: 90%; }
    body[data-precolor="orange"] { --hue-core: 25;  --sat-core: 95%; }
    body[data-precolor="yellow"] { --hue-core: 45;  --sat-core: 90%; }
    body[data-precolor="green"]  { --hue-core: 150; --sat-core: 60%; }
    body[data-precolor="blue"]   { --hue-core: 210; --sat-core: 80%; }
    body[data-precolor="purple"] { --hue-core: 270; --sat-core: 70%; }
    body[data-precolor="khaki"]  { --hue-core: 40;  --sat-core: 30%; }
    body[data-precolor="gray"]   { --hue-core: 210; --sat-core: 10%; }
    body[data-precolor="white"]  { --hue-core: 210; --sat-core: 5%; --light-core: 90%; }

    /* 06 Theme 對應 */
    body[data-theme="rose_ember"]       { --hue-core: 15;  --sat-core: 90%; }
    body[data-theme="midnight_tracker"] { --hue-core: 225; --sat-core: 85%; }
    body[data-theme="veil_warden"]      { --hue-core: 30;  --sat-core: 20%; }
    body[data-theme="low_tide_keeper"]  { --hue-core: 170; --sat-core: 40%; }

    /* =========================================
       BACKGROUND SYSTEM (Reference Style)
       ========================================= */
    #ambient-core {
      position: fixed; inset: 0; width: 100vw; height: 100vh;
      z-index: -2; background: var(--color-void);
      overflow: hidden; pointer-events: none;
    }
    
    .aurora-blob {
      position: absolute; border-radius: 50%;
      filter: blur(80px); opacity: 0.5;
      mix-blend-mode: screen;
      animation: drift 25s infinite alternate ease-in-out;
      will-change: transform;
    }
    
    .blob-1 {
      top: -10%; left: -10%; width: 60vw; height: 60vw;
      background: radial-gradient(circle, var(--color-ether-glow), transparent 70%);
    }
    .blob-2 {
      bottom: -10%; right: -20%; width: 70vw; height: 70vw;
      background: radial-gradient(circle, hsl(calc(var(--hue-core) + 30), 70%, 40%), transparent 70%);
      animation-delay: -5s; animation-duration: 30s;
    }
    .blob-3 {
      top: 40%; left: 40%; width: 50vw; height: 50vw;
      background: radial-gradient(circle, hsl(calc(var(--hue-core) - 30), 80%, 45%), transparent 70%);
      animation-delay: -10s; opacity: 0.3;
    }

    @keyframes drift {
      0% { transform: translate(0,0) scale(1) rotate(0deg); }
      50% { transform: translate(10%, 5%) scale(1.1) rotate(5deg); }
      100% { transform: translate(-5%, -10%) scale(0.95) rotate(-5deg); }
    }

    .noise-overlay {
      position: fixed; inset: 0; pointer-events: none; z-index: -1; opacity: 0.05;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    .flashlight-mask {
      position: fixed; inset: 0; pointer-events: none; z-index: 50;
      background: radial-gradient(circle 300px at var(--x, 50%) var(--y, 50%), transparent 0%, rgba(0,0,0,0.4) 100%);
      opacity: 0.6;
    }

    /* =========================================
       GLASSMORPHISM COMPONENTS
       (取代原本的 .sanctuary-wrap 等樣式)
       ========================================= */
    .sanctuary-wrap, .info-card, .mood, .q, .result-page, .arch-card, .hearth-wrap, .pretone, .cinema-overlay-inner {
      background: var(--glass-bg) !important;
      backdrop-filter: blur(var(--glass-blur)) !important;
      -webkit-backdrop-filter: blur(var(--glass-blur)) !important;
      border: 1px solid var(--glass-border) !important;
      box-shadow: var(--glass-shadow) !important;
      border-radius: 24px !important;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    /* Hover Glow Effect */
    .mood:hover, .opt:hover, .pretone:hover, .logo-frame:hover {
      border-color: color-mix(in srgb, var(--color-ether-glow) 50%, transparent) !important;
      box-shadow: 0 0 25px color-mix(in srgb, var(--color-ether-glow) 20%, transparent) !important;
      transform: translateY(-2px);
    }

    /* 掃光特效 */
    .sanctuary-wrap::before, .glass-card::before {
      content: ""; position: absolute; inset: 0; left: -150%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
      transform: skewX(-25deg); transition: left 0.8s ease; pointer-events: none;
    }
    .sanctuary-wrap:hover::before { left: 150%; }

    /* =========================================
       TYPOGRAPHY & LAYOUT
       ========================================= */
    section {
      min-height: 100vh;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      padding: 80px 20px; text-align: center; position: relative; z-index: 2;
    }

    h1, h2, h3 { font-weight: 700; letter-spacing: -0.02em; color: #fff; }
    h1 { font-size: clamp(40px, 6vw, 64px); text-shadow: 0 0 30px var(--color-ether-glow); }
    h2 { font-size: clamp(24px, 4vw, 36px); margin-bottom: 24px; }
    p { color: var(--color-ether-secondary); line-height: 1.7; font-size: 16px; max-width: 600px; }

    .kicker {
      font-size: 11px; letter-spacing: 0.3em; text-transform: uppercase;
      color: var(--color-ether-glow);
      border: 1px solid rgba(255,255,255,0.1);
      padding: 8px 16px; border-radius: 99px;
      background: rgba(255,255,255,0.02);
      margin-bottom: 20px; display: inline-block;
    }

    .secno {
      font-size: 10px; letter-spacing: 0.4em; color: var(--muted);
      opacity: 0.6; margin-bottom: 30px; display: block;
    }

    /* =========================================
       INTERACTIVE ELEMENTS
       ========================================= */
    /* Dots Navigation - Updated Style */
    .dots {
      position: fixed; right: 24px; top: 50%; transform: translateY(-50%);
      z-index: 50; display: flex; flex-direction: column; gap: 16px;
    }
    .dot {
      width: 6px; height: 6px; border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.3); background: transparent;
      padding: 0; cursor: pointer; transition: all 0.3s;
    }
    .dot.active {
      background: var(--color-ether-glow);
      border-color: var(--color-ether-glow);
      box-shadow: 0 0 15px var(--color-ether-glow);
      transform: scale(1.5);
    }
    /* Tooltip styling */
    .dot::after {
      content: attr(data-label); position: absolute; right: 20px; top: 50%;
      transform: translateY(-50%) translateX(10px); opacity: 0;
      background: rgba(0,0,0,0.6); padding: 4px 8px; border-radius: 4px;
      color: #fff; font-size: 10px; letter-spacing: 0.1em;
      pointer-events: none; transition: 0.3s; white-space: nowrap;
    }
    .dot:hover::after { opacity: 1; transform: translateY(-50%) translateX(0); }

    /* Buttons */
    .ghost-btn, button[type="submit"] {
      padding: 14px 32px; border-radius: 99px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: #fff; font-weight: 600; letter-spacing: 0.1em;
      cursor: pointer; transition: all 0.3s;
      text-transform: uppercase; font-size: 14px;
      position: relative; overflow: hidden;
    }
    .ghost-btn:hover, button[type="submit"]:hover {
      background: var(--color-ether-glow);
      color: #000; border-color: var(--color-ether-glow);
      box-shadow: 0 0 30px var(--color-ether-glow);
    }
    .ghost-btn[disabled] { opacity: 0.3; cursor: not-allowed; pointer-events: none; }

    /* Inputs */
    input[type="email"] {
      background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);
      color: #fff; padding: 14px 20px; border-radius: 12px; width: 320px;
      font-family: inherit; transition: 0.3s; outline: none;
    }
    input[type="email"]:focus {
      border-color: var(--color-ether-glow);
      box-shadow: 0 0 15px rgba(255,255,255,0.1);
    }

    /* Pre-tone Grid */
    .pretone-grid {
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
      margin-top: 20px; width: 100%;
    }
    @media (max-width: 600px) { .pretone-grid { grid-template-columns: repeat(2, 1fr); } }
    
    .pretone {
      display: flex; align-items: center; gap: 8px;
      padding: 12px; cursor: pointer; color: rgba(255,255,255,0.8);
    }
    .pretone .chip {
      width: 12px; height: 12px; border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.2);
    }
    .pretone.active {
      background: rgba(255,255,255,0.1) !important;
      border-color: var(--color-ether-glow) !important;
    }

    /* Logo & Flame Frame - Circle Aesthetic */
    .logo-frame, .flame-frame {
      width: 200px; height: 200px;
      display: grid; place-items: center;
      border-radius: 50% !important; /* 強制圓形 */
      border: 1px solid rgba(255,255,255,0.1) !important;
      background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%) !important;
      margin-bottom: 30px;
    }
    .logo-mark, .flame-img {
      filter: drop-shadow(0 0 20px var(--color-ether-glow));
      animation: breathe-cycle 6s infinite ease-in-out;
    }

    @keyframes breathe-cycle {
      0%, 100% { transform: scale(1); opacity: 0.8; filter: drop-shadow(0 0 10px var(--color-ether-glow)); }
      50% { transform: scale(1.05); opacity: 1; filter: drop-shadow(0 0 25px var(--color-ether-glow)); }
    }

    /* Quiz Options */
    .opt {
      background: rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px; padding: 16px; margin-bottom: 8px;
      cursor: pointer; transition: 0.3s;
    }
    .opt.active {
      background: rgba(255,255,255,0.1);
      border-color: var(--color-ether-glow);
      box-shadow: 0 0 15px rgba(255,255,255,0.05);
    }

    /* Footer */
    .footer-mark {
      opacity: 0.3; letter-spacing: 0.2em; font-size: 10px; margin-top: 40px;
    }
    .links a { border-bottom: 1px solid rgba(255,255,255,0.2); transition: 0.3s; }
    .links a:hover { color: var(--color-ether-glow); border-color: var(--color-ether-glow); }

    /* Reveal Animation */
    .reveal { opacity: 0; transform: translateY(30px); transition: all 1s ease; }
    .reveal.in { opacity: 1; transform: translateY(0); }

    /* Overwrite specific section backgrounds to be transparent so blobs show */
    .s1, .s2, .s3, .s4, .s4b, .s5, .s6, .s7, .s8 { background: transparent !important; }

    /* Canvas Adjustment */
    #flameCanvas {
      filter: contrast(1.2) brightness(1.1); /* 增強粒子亮度 */
    }
  </style>
</head>

<body data-precolor="black">

  <div id="ambient-core" aria-hidden="true">
    <div class="aurora-blob blob-1"></div>
    <div class="aurora-blob blob-2"></div>
    <div class="aurora-blob blob-3"></div>
    <div class="noise-overlay"></div>
  </div>

  <div class="flashlight-mask" id="cursor-light"></div>

  <nav class="dots" id="dotsNav" aria-label="Section navigation">
    <button class="dot" data-target="s1"  data-label="HERO" aria-label="Go to Hero"></button>
    <button class="dot" data-target="s1b" data-label="TONE" aria-label="Go to Tone"></button>
    <button class="dot" data-target="s2"  data-label="WHO WE ARE" aria-label="Go to Who We Are"></button>
    <button class="dot" data-target="s3"  data-label="BRAND MARK" aria-label="Go to Brand Mark"></button>
    <button class="dot" data-target="s4b" data-label="BRAND TAGLINE" aria-label="Go to Brand Tagline"></button>
    <button class="dot" data-target="s4"  data-label="SANCTUARY" aria-label="Go to Sanctuary"></button>
    <button class="dot" data-target="s5"  data-label="AESTHETIC" aria-label="Go to Aesthetic Alignment"></button>
    <button class="dot" data-target="s6"  data-label="REFLECTION" aria-label="Go to Introspective Reflection"></button>
    <button class="dot" data-target="s7"  data-label="ARCHETYPE" aria-label="Go to Archetype"></button>
    <button class="dot" data-target="s8"  data-label="HEARTH" aria-label="Go to Our Flame"></button>
  </nav>

  <section class="s1" id="s1">
    <div class="brand">
      <img class="wordmark reveal in" src="wordmark.png" alt="HESTIA wordmark" style="width: 300px; filter: drop-shadow(0 0 20px var(--color-ether-glow));" />
      <div class="submark" style="letter-spacing: 0.5em; font-size: 14px; opacity: 0.7;">TAIWAN</div>
    </div>

    <div class="tagline" style="font-size: 18px; margin-top: 30px; color: var(--color-ether-glow);">
      即將到來，搶先進入 HEST<span class="i-accent">i</span>A 宇宙
    </div>
    <div class="arrow" style="margin-top: 40px; animation: drift 2s infinite ease-in-out;">↓</div>
  </section>

  <section class="s1b" id="s1b">
    <div class="secno reveal">TONE</div>

    <div class="sanctuary-wrap" id="pretoneWrap">
      <div class="sanctuary-kicker">
        <span class="kicker reveal in">INNER TEMPERATURE</span>
      </div>

      <h2 class="reveal">先選一個你喜歡的色調</h2>
      <p class="reveal">
        這將決定 HESTiA 宇宙在你眼中的第一道光譜。
      </p>

      <div class="pretone-grid reveal" id="pretoneGrid" aria-label="Pre-tone color palette">
        <div class="pretone" data-pre="red"    data-hex="#B91C1C"><span class="chip" style="background:#B91C1C"></span><span class="nm">燼紅</span></div>
        <div class="pretone" data-pre="orange" data-hex="#D9480F"><span class="chip" style="background:#D9480F"></span><span class="nm">熔橙</span></div>
        <div class="pretone" data-pre="yellow" data-hex="#C8A100"><span class="chip" style="background:#C8A100"></span><span class="nm">鎏金</span></div>
        <div class="pretone" data-pre="green"  data-hex="#1F7A5A"><span class="chip" style="background:#1F7A5A"></span><span class="nm">苔息</span></div>
        <div class="pretone" data-pre="blue"   data-hex="#2B4C7E"><span class="chip" style="background:#2B4C7E"></span><span class="nm">深海</span></div>

        <div class="pretone" data-pre="purple" data-hex="#5B2C83"><span class="chip" style="background:#5B2C83"></span><span class="nm">暮紫</span></div>
        <div class="pretone" data-pre="khaki"  data-hex="#A8925A"><span class="chip" style="background:#A8925A"></span><span class="nm">砂金</span></div>
        <div class="pretone" data-pre="black"  data-hex="#0B0C10"><span class="chip" style="background:#0B0C10"></span><span class="nm">曜黑</span></div>
        <div class="pretone" data-pre="gray"   data-hex="#3A3A3A"><span class="chip" style="background:#3A3A3A"></span><span class="nm">霧灰</span></div>
        <div class="pretone" data-pre="white"  data-hex="#F5F5F5"><span class="chip" style="background:#F5F5F5"></span><span class="nm">象牙</span></div>
      </div>

      <div class="microcopy reveal" style="margin-top: 20px;">
        已選擇：<span id="pretonePicked" class="we-accent">—</span>
      </div>

      <div class="arch-actions reveal">
        <button class="ghost-btn" id="toWhoBtn" type="button">繼續探索</button>
      </div>
    </div>
  </section>

  <section class="s2" id="s2">
    <div class="secno reveal">02</div>
    <h2 class="reveal who-title">WHO <span class="we-accent">WE</span> ARE?</h2>

    <div class="info-card reveal">
      <div class="mini"><span class="kicker">WHY HESTiA?</span></div>
      <p class="late" data-late>HESTiA 的名字來自希臘神話中守護火爐的女神，</p>
      <p class="late" data-late>象徵<span class="hair-underline">歸屬</span>、<span class="hair-underline">溫暖</span>與內在之火。</p>
      <p class="late" data-late>我們相信，每個人心中都有一簇火焰，</p>
      <p class="late" data-late>等待被看見、被擁抱、被點燃。</p>
    </div>

    <div class="info-card reveal" style="margin-top:20px;">
      <div class="mini"><span class="kicker">WHAT WE DO</span></div>
      <p class="late" data-late>HESTiA 是一個健身與生活並行的服裝品牌。</p>
      <p class="late" data-late>不管在生活與訓練之間，都能展現符合自己的自信與品味。</p>
    </div>
  </section>

  <section class="s3" id="s3">
    <div class="stack">
      <div class="secno reveal">03</div>

      <div class="logo-frame frame-size" id="logoFrame" role="button" aria-label="Interact with brand mark" tabindex="0" data-mode="primary">
        <div class="corner-hint" aria-hidden="true"></div>
        <img class="logo-mark" id="logoMark" src="HLOGO.png" alt="HESTIA mark" />
      </div>

      <div class="label reveal">BRAND MARK</div>
      <h2 class="reveal">品牌識別</h2>

      <div class="bullets">
        <div class="bullet reveal">LOGO 靈感來自「火焰燃燒的線條」，帶出<span class="hair-underline">力量</span>與<span class="hair-underline">節制</span>的平衡。</div>
        <div class="bullet reveal">拱型外型呼應爐灶女神的意象，象徵<span class="hair-underline">歸屬</span>、<span class="hair-underline">溫暖</span>與內在之火。</div>
        <div class="bullet reveal">代表力量與柔韌的平衡，也象徵身體與心靈的統一。</div>
      </div>
    </div>
  </section>

  <section class="s4b" id="s4b">
    <div class="secno reveal">04</div>

    <div class="flame-stage">
      <div style="display:flex;justify-content:center;margin-bottom:4px;">
        <span class="kicker reveal">FLAME MARK</span>
      </div>

      <div class="flame-frame" id="flameFrame" aria-label="Flame Mark reveal">
        <div class="corner-hint" aria-hidden="true"></div>
        <img class="flame-img" id="flameImg" src="Flamemark.png" alt="Flame Mark" />
      </div>

      <h2 class="reveal">標語的符號</h2>

      <div class="manifest center flame-copy reveal">
        <p class="late" data-late>這不只是口號，而是一種信念。</p>
        <p class="late" data-late>標籤又如何？那是與生俱來的特色。</p>
        <p class="late" data-late>HESTIA 透過品牌標語「Own Your Flame」</p>
        <p class="late" data-late>無論性別、身形、背景，這些火焰屬於你自己。</p>
        <p class="late" data-late>不用變成誰，你只需要更像你！</p>
      </div>
    </div>
  </section>

  <section class="s4" id="s4">
    <div class="sanctuary-wrap">
      <div class="sanctuary-kicker">
        <span class="kicker reveal">SANCTUARY</span>
      </div>
      <h2 class="reveal">SANCTUARY</h2>
      <p class="reveal">
        下面將是一段短暫的沉靜引導，繼續滑動往下探索。
      </p>
    </div>
  </section>

  <section class="s4" id="s4a" aria-label="Sanctuary Guide">
    <div class="guide-wrap">
      <div class="sanctuary-kicker">
        <span class="kicker reveal">SANCTUARY GUIDE</span>
      </div>

      <div class="cinema guide-cinema" aria-live="polite">
        <div class="cinema-step" id="gc1"><p>現在安靜下來</p></div>
        <div class="cinema-step" id="gc2"><p>讓我帶領你進入 HESTiA 宇宙</p></div>
        <div class="cinema-step" id="gc3"><p>接下來的每一個選擇</p></div>
        <div class="cinema-step" id="gc4"><p>都是你與我們共感的瞬間</p></div>
        <div class="cinema-step" id="gc5"><p>你的每一個答案</p></div>
        <div class="cinema-step" id="gc6"><p>將影響 HESTiA 首波上市系列配色</p></div>
        <div class="cinema-step" id="gc7"><p>向下滑動開始吧！</p></div>
      </div>
    </div>
  </section>

  <section class="s5" id="s5">
    <div class="secno reveal">06</div>

    <div class="sanctuary-wrap">
      <div class="sanctuary-kicker"><span class="kicker reveal">AESTHETIC ALIGNMENT</span></div>
      <h2 class="reveal">你偏好的「穿著色調」</h2>
      <p class="reveal">
        依照描述選擇符合自己偏好的穿著色彩。
      </p>

      <div class="align-grid" id="alignGrid" aria-label="Aesthetic alignment choices">
        <div class="mood reveal" role="button" tabindex="0"
             data-theme="rose_ember" data-value="ROSE EMBER" data-animal="PHOENIX">
          <div class="row">
            <div>
              <div class="title">ROSE EMBER</div>
              <p class="desc">色彩溫暖明亮，像光一般登場；在被看見與被回應中，越分享越被點燃。</p>
            </div>
            <div class="sw" aria-hidden="true">
              <span class="dot-swatch" style="background:#F24B1E;"></span>
              <span class="dot-swatch" style="background:#ff9150;"></span>
            </div>
          </div>
        </div>

        <div class="mood reveal" role="button" tabindex="0"
             data-theme="midnight_tracker" data-value="GLACIAL STRIKER" data-animal="BLACK WOLF">
          <div class="row">
            <div>
              <div class="title">GLACIAL STRIKER</div>
              <p class="desc">冷色主導但彩度極高；雖有似冰山的外表，同時也有強烈的內在。</p>
            </div>
            <div class="sw" aria-hidden="true">
              <span class="dot-swatch" style="background:#00b4ff;"></span>
              <span class="dot-swatch" style="background:#00e5c4;"></span>
            </div>
          </div>
        </div>

        <div class="mood reveal" role="button" tabindex="0"
             data-theme="veil_warden" data-value="VEIL WARDEN" data-animal="DEER">
          <div class="row">
            <div>
              <div class="title">VEIL WARDEN</div>
              <p class="desc">色彩避開太搶眼的視覺與彩度刺激，應該是讓人感覺溫暖且踏實。</p>
            </div>
            <div class="sw" aria-hidden="true">
              <span class="dot-swatch" style="background:#b8a89a;"></span>
              <span class="dot-swatch" style="background:#d0c2b6;"></span>
            </div>
          </div>
        </div>

        <div class="mood reveal" role="button" tabindex="0"
             data-theme="low_tide_keeper" data-value="LOW TIDE KEEPER" data-animal="PYTHON">
          <div class="row">
            <div>
              <div class="title">LOW TIDE KEEPER</div>
              <p class="desc">習慣選擇冷色與暗色堆疊，冷靜沉穩中又帶點低調神祕。</p>
            </div>
            <div class="sw" aria-hidden="true">
              <span class="dot-swatch" style="background:#0F2E2B;"></span>
              <span class="dot-swatch" style="background:#2F4F4B;"></span>
            </div>
          </div>
        </div>
      </div>

      <div class="microcopy reveal" style="margin-top:20px;">
        已選擇：<span id="alignPicked" class="we-accent">—</span>
      </div>
    </div>
  </section>

  <section class="s6" id="s6">
    <div class="secno reveal">07</div>

    <div class="sanctuary-wrap">
      <div class="sanctuary-kicker"><span class="kicker reveal">INTROSPECTIVE REFLECTION</span></div>
      <h2 class="reveal">你的節奏與生活方式</h2>
      <p class="reveal">
        用直覺選，哪些是你最常回到的那種狀態？
      </p>

      <div class="quiz" id="quiz">
        <div class="q reveal" data-q="q1">
          <h3>當你開始想動起來，你更接近哪種狀態？</h3>
          <div class="opts">
            <div class="opt" role="button" tabindex="0" data-q="q1" data-a="A">先把四周的聲音調低，慢慢把注意力收回自己。</div>
            <div class="opt" role="button" tabindex="0" data-q="q1" data-a="B">需要一點火花或節奏，情緒一被點亮，身體自然跟上。</div>
            <div class="opt" role="button" tabindex="0" data-q="q1" data-a="C">目標先立起來；目的越清楚，我越能直接進入狀態。</div>
          </div>
        </div>

        <div class="q reveal" data-q="q2">
          <h3>生活中，你希望穿著帶給你的是？</h3>
          <div class="opts">
            <div class="opt" role="button" tabindex="0" data-q="q2" data-a="A">簡單、穩定，安全牌的穿搭，可以每天不需要多想。</div>
            <div class="opt" role="button" tabindex="0" data-q="q2" data-a="B">有變化、有能量；可以依照我的心情喜好調整搭配。</div>
            <div class="opt" role="button" tabindex="0" data-q="q2" data-a="C">看似一成不變，但透過細節亮點和人搭起話題。</div>
          </div>
        </div>

        <div class="q reveal" data-q="q3">
          <h3>完成一段訓練後，你最想留下的是？</h3>
          <div class="opts">
            <div class="opt" role="button" tabindex="0" data-q="q3" data-a="A">一種安定與歸屬：像每天按部就班的完成感。</div>
            <div class="opt" role="button" tabindex="0" data-q="q3" data-a="B">一股被釋放的熱：像重新啟動，越來越好的自己。</div>
            <div class="opt" role="button" tabindex="0" data-q="q3" data-a="C">清楚俐落的完成感：知道自己在進度條的哪個位置上，且做的準、做得好。</div>
          </div>
        </div>

        <div class="q reveal" data-q="q4">
          <h3>在日常生活裡，你更常用哪種方式維持狀態？</h3>
          <div class="opts">
            <div class="opt" role="button" tabindex="0" data-q="q4" data-a="B">我需要變化與刺激：新鮮感會讓我更想出門、更想動。</div>
            <div class="opt" role="button" tabindex="0" data-q="q4" data-a="A">固定的步調、固定的選擇，穩定；就是最省力的。</div>
            <div class="opt" role="button" tabindex="0" data-q="q4" data-a="C">我習慣做取捨：把多餘的拿掉，留下有效與精準。</div>
          </div>
        </div>

        <div class="q reveal" data-q="q5">
          <h3>如果可以嘗試成為另一種個性，你會選？</h3>
          <div class="opts">
            <div class="opt" role="button" tabindex="0" data-q="q5" data-a="PHOENIX">想更華麗、張揚，讓能量被看見也樂於分享。</div>
            <div class="opt" role="button" tabindex="0" data-q="q5" data-a="KINGFISHER">想更冰冷、距離感，內心卻強烈且行動力十足。</div>
            <div class="opt" role="button" tabindex="0" data-q="q5" data-a="DEER">想更溫和、規律，讓生活有更多可持續的規畫與動力。</div>
            <div class="opt" role="button" tabindex="0" data-q="q5" data-a="PYTHON">想更冷靜、觀察，沉住氣再一擊掌控成功。</div>
          </div>
        </div>

        <div class="quiz-actions reveal">
          <div class="unlock-hint" id="unlockHint">完成前四題後，按鈕會點亮。</div>
          <button class="ghost-btn" id="unlockBtn" type="button" disabled>解鎖我的原型</button>
        </div>
      </div>
    </div>
  </section>

  <section class="s7" id="s7">
    <div class="secno reveal">08</div>

    <div class="result-page" id="resultPage" aria-live="polite">
      <div class="rp-kicker"><span class="kicker reveal">YOUR ARCHETYPE</span></div>

      <div class="result-shell">
        <div class="arch-emblem reveal">
          <div class="emblem-slot">
            <img id="archetypeEmblem" class="emblem-img" src="" alt="HESTIA Archetype Emblem">
          </div>
        </div>

        <div>
          <div class="arch-title reveal" id="archTitle">—</div>
          <div class="arch-sub reveal" id="archKey">—</div>

          <div class="arch-grid">
            <div class="arch-card reveal">
              <div class="t">CORE STATE</div>
              <p class="v" id="archCore">—</p>
            </div>
            <div class="arch-card reveal">
              <div class="t">TRAINING + LIFE RHYTHM</div>
              <p class="v" id="archRhythm">—</p>
            </div>
            <div class="arch-card reveal">
              <div class="t">STYLE + COLOR DIRECTION</div>
              <p class="v" id="archStyle">—</p>
            </div>
          </div>

          <div class="microcopy reveal" style="text-align:center; margin-top:20px;">
            你選的色調：<span class="we-accent" id="alignPicked2">—</span>｜
            你的原型：<span class="we-accent" id="archPicked">—</span>
          </div>

          <div class="result-watermark reveal">
            <img src="HLOGO.png" alt="HESTIA watermark logo" />
            <span>HESTIA TAIWAN®</span>
          </div>

          <div class="arch-actions reveal">
            <button class="ghost-btn" id="toHearthBtn" type="button">把光點投入火焰</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="s8" id="s8">
    <div class="secno reveal">09</div>

    <div class="hearth-wrap">
      <div class="hearth-top">
        <div style="display:flex;justify-content:center;margin-bottom:2px;position:relative;z-index:2;">
          <span class="kicker reveal">COLLECTIVE HEARTH</span>
        </div>

        <canvas class="hearth-canvas" id="flameCanvas" aria-label="Hestia Our Flame"></canvas>

        <div class="hearth-level reveal">
          HEARTH LEVEL：<span id="hearthLevel" class="we-accent">—</span>
        </div>

        <h2 class="reveal" style="margin-bottom:6px;">共焰｜OUR FLAME</h2>
        <p class="reveal" style="max-width:680px;">
          把你的光點，投入火焰！不用搶先，只要行動。
        </p>

        <form id="notify"
              action="https://docs.google.com/forms/d/e/1FAIpQLSfmk4ZgMlWpAbFKa6x1JNAq0hwn6kzXtOoB9e9nIbZxsAuNTA/formResponse"
              method="POST" target="hidden_iframe" autocomplete="off" onsubmit="return submitGForm(event)">

          <input id="email" type="email" name="entry.345729382" placeholder="輸入你的Email搶先收到最新消息" required />

          <input type="hidden" id="f_pretone" name="entry.204433983" value="">
          <input type="hidden" id="f_06" name="entry.324440347" value="">
          <input type="hidden" id="f_0701" name="entry.1640422124" value="">
          <input type="hidden" id="f_0702" name="entry.1471764886" value="">
          <input type="hidden" id="f_0703" name="entry.2009680739" value="">
          <input type="hidden" id="f_0704" name="entry.1968121576" value="">
          <input type="hidden" id="f_0705" name="entry.558120237" value="">

          <button id="tendBtn" type="submit">加入火焰</button>
        </form>

        <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

        <div class="links reveal">
          <a href="https://www.instagram.com/hestia.taiwan/" target="_blank" rel="noopener">Instagram</a>
          <a href="https://lin.ee/kjso8Ba" target="_blank" rel="noopener">LINE 官方帳號</a>
        </div>

        <div class="footer-mark">HESTIA TAIWAN®</div>
      </div>
    </div>
  </section>

  <div class="toast" id="toast">訂閱成功！我們將在第一時間通知你最新消息。</div>

  <script>
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    // Flashlight Effect (Desktop)
    const mask = document.getElementById("cursor-light");
    if (mask && !window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
      document.addEventListener("mousemove", (e) => {
        mask.style.setProperty("--x", `${e.clientX}px`);
        mask.style.setProperty("--y", `${e.clientY}px`);
      }, { passive: true });
    }

    function sleep(ms){ return new Promise(res => setTimeout(res, ms)); }

    function inView(el, topRatio=0.78, bottomRatio=0.18){
      if(!el) return false;
      const r = el.getBoundingClientRect();
      const vh = window.innerHeight || document.documentElement.clientHeight;
      const topLine = vh * topRatio;
      const bottomLine = vh * bottomRatio;
      return (r.top <= topLine) && (r.bottom >= bottomLine);
    }

    /* =========================
       Reveal + requestCheck
       ========================= */
    const logoFrame = $('#logoFrame');
    const logoMark  = $('#logoMark');
    const flameFrame = $('#flameFrame');
    const flameImg   = $('#flameImg');

    let logoRevealed = false;
    let flameRevealed = false;
    let ticking = false;

    function rafCheck(){
      ticking = false;
      $$('.reveal').forEach(el=>{
        if(!el.classList.contains('in') && inView(el, 0.86, 0.05)) el.classList.add('in');
      });
      $$('.late[data-late]').forEach(el=>{
        if(!el.classList.contains('in') && inView(el, 0.86, 0.05)) el.classList.add('in');
      });

      if(logoFrame && logoMark && !logoRevealed && inView(logoFrame, 0.80, 0.15)){
        logoRevealed = true;
        logoFrame.classList.add('in');
        setTimeout(()=>logoMark.classList.add('in'), 520);
        setTimeout(()=>logoFrame.classList.add('sheen'), 1200);
      }

      if(flameFrame && flameImg && !flameRevealed && inView(flameFrame, 0.80, 0.15)){
        flameRevealed = true;
        flameFrame.classList.add('in');
        setTimeout(()=>flameImg.classList.add('in'), 520);
      }
    }

    function requestCheck(){
      if(ticking) return;
      ticking = true;
      requestAnimationFrame(rafCheck);
    }

    window.addEventListener('scroll', requestCheck, { passive:true });
    window.addEventListener('load', requestCheck);
    window.addEventListener('resize', requestCheck);
    requestCheck();

    /* LOGO click cycle */
    const modes = ['primary','fabric','mono'];
    let modeIdx = 0;
    function popOnce(){
      logoFrame.classList.remove('pulse');
      logoMark.classList.remove('pop');
      void logoFrame.offsetWidth;
      logoFrame.classList.add('pulse');
      logoMark.classList.add('pop');
    }
    function cycleMode(){
      modeIdx = (modeIdx + 1) % modes.length;
      logoFrame.setAttribute('data-mode', modes[modeIdx]);
      popOnce();
    }
    logoFrame.addEventListener('click', cycleMode);
    logoFrame.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); cycleMode(); }
    });

    /* Toast */
    const toast = $('#toast');
    let toastTimer = null;
    function showToast(msg, ms=1100){
      if(!toast) return;
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toast.classList.remove('show'), ms);
    }

    /* =========================
       PRETONE
       ========================= */
    const PRETONE_KEY = 'hestia_pretone';
    const pretonePicked = $('#pretonePicked');
    const pretoneWrap = $('#pretoneWrap');
    const breath = $('#breath');

    function pretoneFeedback(hex, label){
      if(pretoneWrap){
        pretoneWrap.classList.remove('pretone-flash');
        void pretoneWrap.offsetWidth;
        pretoneWrap.classList.add('pretone-flash');
      }
      if(breath){
        breath.classList.add('pretone-kick');
        setTimeout(()=>breath.classList.remove('pretone-kick'), 720);
      }
      const t = label ? `PRE-TONE 已套用｜${label}` : `PRE-TONE 已套用｜${hex || ''}`;
      showToast(t, 980);
    }

    function setPreTone(preKey, hex, label){
      const key = preKey || '';
      if(key){
        document.body.setAttribute('data-precolor', key);
        localStorage.setItem(PRETONE_KEY, key);
      } else {
        document.body.removeAttribute('data-precolor');
        localStorage.removeItem(PRETONE_KEY);
      }
      if(pretonePicked) pretonePicked.textContent = (label || '—');
      pretoneFeedback(hex, label);
      setTimeout(requestCheck, 80);
    }

    function initPreTone(){
      const saved = localStorage.getItem(PRETONE_KEY) || '';
      if(saved) document.body.setAttribute('data-precolor', saved);
    }
    initPreTone();

    const pretoneBtns = $$('#pretoneGrid .pretone');
    pretoneBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        pretoneBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        setPreTone(btn.dataset.pre, btn.dataset.hex, btn.querySelector('.nm')?.textContent || '');
      });
    });

    (function syncPreToneUI(){
      const saved = localStorage.getItem(PRETONE_KEY) || '';
      if(!saved) return;
      const hit = pretoneBtns.find(b=>b.dataset.pre === saved);
      if(hit){
        pretoneBtns.forEach(b=>b.classList.remove('active'));
        hit.classList.add('active');
        if(pretonePicked) pretonePicked.textContent = hit.querySelector('.nm')?.textContent || '—';
      }
    })();

    $('#toWhoBtn')?.addEventListener('click', ()=>{
      const s2 = document.getElementById('s2');
      if(s2) s2.scrollIntoView({behavior:'smooth', block:'start'});
      setTimeout(requestCheck, 160);
    });

    /* =========================
       06 Aesthetic
       ========================= */
    const moods = $$('#alignGrid .mood');
    const alignPicked = $('#alignPicked');
    const alignPicked2 = $('#alignPicked2');
    const emblemMap = {
      rose_ember: "ROSE.png",
      midnight_tracker: "MID.png",
      veil_warden: "VEIL.png",
      low_tide_keeper: "LOW.png"
    };

    let currentTheme = '';
    let currentAlign = '';
    let currentAnimal = '';

    function setTheme(theme, value, animal){
      currentTheme = theme || '';
      currentAlign = value || '';
      currentAnimal = animal || '';

      document.body.setAttribute('data-theme', currentTheme);

      if(alignPicked)  alignPicked.textContent  = currentAlign || '—';
      if(alignPicked2) alignPicked2.textContent = currentAlign || '—';

      moods.forEach(m=>{
        const on = currentTheme && (m.dataset.theme === currentTheme);
        m.classList.toggle('active', on);
        m.classList.toggle('dim', currentTheme ? !on : false);
      });
      setTimeout(()=>{ moods.forEach(m=>m.classList.remove('dim')); }, 900);
    }

    function initTheme(){ setTheme('', '', ''); }
    initTheme();

    moods.forEach(m=>{
      const act = ()=> setTheme(m.dataset.theme, m.dataset.value, m.dataset.animal);
      m.addEventListener('click', act);
      m.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); act(); }
      });
    });

    /* =========================================================
       07/08 Archetype Logic
       ========================================================= */
    const Q07_INDEX_TO_ABC = { 1: "B", 2: "A", 3: "C" };
    const TIE_PRIORITY = ["B", "A", "C"];

    function derive07BiasFromIndexes(qIdx){
      const counts = { A:0, B:0, C:0 };
      ["q1","q2","q3","q4"].forEach(k=>{
        const idx = qIdx[k];
        const abc = Q07_INDEX_TO_ABC[idx];
        if(abc) counts[abc] += 1;
      });
      const maxVal = Math.max(counts.A, counts.B, counts.C);
      const tied = Object.keys(counts).filter(k => counts[k] === maxVal);
      if(tied.length === 1) return tied[0];
      for(const k of TIE_PRIORITY){
        if(tied.includes(k)) return k;
      }
      return "B";
    }

    function archetypeKeyFromTheme(){
      if(currentTheme === "rose_ember") return "PHOENIX";
      if(currentTheme === "midnight_tracker") return "PANTHER";
      if(currentTheme === "veil_warden") return "DEER";
      if(currentTheme === "low_tide_keeper") return "PYTHON";
      return "PHOENIX";
    }

    const RESULT_COPY = {
      "PHOENIX_A": {
        rhythm: "你適合在狀態到位時「順勢推進」的節奏。訓練與生活不必過度規劃，抓住能量高點行動，反而能帶來最大成長。",
        style: "你會自然被高對比、明確色彩吸引。偏好能量感強的配色與俐落輪廓，穿著對你而言是一種宣告，而不是背景。"
      },
      "PHOENIX_B": {
        rhythm: "你適合有節奏的推進方式，在穩定中累積能量。訓練與生活彼此支撐，不追求爆發，但每一步都算數。",
        style: "你傾向溫暖但不張揚的色系，細節、耐看、可重複搭配的設計，會讓你感覺越穿越對。"
      },
      "PHOENIX_C": {
        rhythm: "你需要在推進與休息之間留白。訓練與生活應保留彈性，避免一次燃燒過多，讓狀態能長期維持。",
        style: "你會選擇讓穿著成為保護層，而非視覺焦點。幫助你保留狀態，而不是對外表達。"
      },
      "PANTHER_A": {
        rhythm: "你適合主動掌控節奏，設定目標後直接推進。訓練與生活對你而言是執行系統，清楚、果斷、不拖延。",
        style: "你偏好高對比與強輪廓能呼應你的主權感，穿著對你而言是行動的一部分，能快速進入狀態、直接推進。"
      },
      "PANTHER_B": {
        rhythm: "你在穩定節奏中發揮最佳表現。訓練與生活越有秩序，你的力量越能完整展現。",
        style: "你喜好的穿著不必多變，但能支持你維持每天的應用場合，不用擔心穿錯或擔心穿什麼。"
      },
      "PANTHER_C": {
        rhythm: "你需要清楚界線來維持狀態。訓練與生活都不適合過度干擾，保留空間反而讓你更強。",
        style: "你會傾向低曝光、低彩度的色系。穿著不必吸睛，反而更在意要耐看、耐穿。"
      },
      "DEER_A": {
        rhythm: "你適合在感覺對的時候行動。訓練與生活應保留變化，讓身體與情緒帶路，而不是被計畫綁住。",
        style: "你會被自然對比與流動感吸引。穿著色彩需要有呼吸感，而非過度複雜。"
      },
      "DEER_B": {
        rhythm: "你適合溫和而可持續的節奏。訓練與生活需要一致，穩定感會直接反映在狀態上。",
        style: "你偏好柔和、低彩度的色系。穿著的合適與熟悉感會影響你對一件衣服的長期喜好。"
      },
      "DEER_C": {
        rhythm: "你需要高度配合當下狀態。訓練與生活不宜勉強，調整本身就是前進的一部分。",
        style: "你會選擇視覺存在感溫和的穿著，可以讓你自在舒服地停留在自己的狀態裡。"
      },
      "PYTHON_A": {
        rhythm: "你適合在鎖定方向後持續加壓。訓練與生活一旦有了目的，就能長時間推進。",
        style: "你偏好存在感強但不花俏的設計。穿著應該讓視覺感覺集中收斂，也不需要變化太多。"
      },
      "PYTHON_B": {
        rhythm: "你在長期穩定輸出中最有優勢。訓練與生活不求變化，而求深度與持續。",
        style: "你偏好穿著是低調、厚實、耐看的配色。衣服對你而言不是每天重新做選擇。"
      },
      "PYTHON_C": {
        rhythm: "你需要避免頻繁切換。訓練與生活適合單一路線深挖，保留能量比速度更重要。",
        style: "你偏好讓穿著保持低調與節制。顏色成為人群裡的保護層，而非視覺焦點。"
      }
    };

    function applyResultCopy(archetypeKey, bias){
      const key = `${archetypeKey}_${bias}`;
      const copy = RESULT_COPY[key] || RESULT_COPY[`${archetypeKey}_B`];
      if(copy){
        if(archRhythm) archRhythm.textContent = copy.rhythm;
        if(archStyle)  archStyle.textContent  = copy.style;
      }
      return { bias, key };
    }

    const unlockBtn = $('#unlockBtn');
    const unlockHint = $('#unlockHint');
    const archPicked  = $('#archPicked');
    const archTitle = $('#archTitle');
    const archKey    = $('#archKey');
    const archCore   = $('#archCore');
    const archRhythm= $('#archRhythm');
    const archStyle = $('#archStyle');

    const answers = { q1:null, q2:null, q3:null, q4:null, q5:null };
    const answerIdx = { q1:null, q2:null, q3:null, q4:null };
    const opts = $$('.opt');

    function getOptionIndexWithinQuestion(optEl){
      const q = optEl.dataset.q;
      const group = opts.filter(o => o.dataset.q === q);
      const idx = group.indexOf(optEl);
      return idx >= 0 ? (idx + 1) : null;
    }

    function archetypeByAlign(){
      if(currentAlign === 'VEIL WARDEN'){
        return { key:'VEIL WARDEN', zh:'霧幕守望者', coreBase:'你偏好低刺激、可持續的溫柔秩序；越規律，越能讓狀態長期在線。' };
      }
      if(currentAlign === 'GLACIAL STRIKER'){
        return { key:'GLACIAL STRIKER', zh:'冷川襲擊者', coreBase:'你重視精準與行動推進感；越清楚目標，越能把自己帶到結果。' };
      }
      if(currentAlign === 'LOW TIDE KEEPER'){
        return { key:'LOW TIDE KEEPER', zh:'低伏掌控者', coreBase:'你擅長把能量收起來；看似安靜，其實一直在觀察時機，一舉勝利。' };
      }
      return { key:'ROSE EMBER', zh:'玫燼點燃者', coreBase:'你喜歡讓能量被看見；華麗不是浮誇，而是你願意把狀態分享出去的方式。' };
    }

    function computeArchetype(){
      const base = archetypeByAlign();
      const bias = derive07BiasFromIndexes(answerIdx);
      const archetypeKey = archetypeKeyFromTheme();
      return { key: base.key, zh: base.zh, core: base.coreBase, bias, archetypeKey };
    }

    function updateUnlock(){
      const reqOk = ["q1","q2","q3","q4"].every(k => Boolean(answerIdx[k])) && Boolean(answers.q5);
      unlockBtn.disabled = !reqOk;
      unlockBtn.classList.toggle('ready', reqOk);
      if(unlockHint) unlockHint.textContent = reqOk ? '已完成。點擊「解鎖我的原型」。' : '完成前四題後，按鈕會點亮。';
    }

    function setOptState(q, chosenEl){
      const group = opts.filter(o=>o.dataset.q === q);
      group.forEach(o=>{
        const on = (o === chosenEl);
        o.classList.toggle('active', on);
        o.classList.toggle('dim', !on);
      });
      setTimeout(()=>{ group.forEach(o=>o.classList.remove('dim')); }, 700);
    }

    const Q07_01_03_INDEX_TO_VALUE = { 1: "B", 2: "A", 3: "C" };
    const Q0704_INDEX_TO_VALUE = { 1: "A", 2: "B", 3: "C" };    
    opts.forEach(o=>{
      const act = ()=>{
        const q = o.dataset.q;
        const a = o.dataset.a;
        const idx = (q !== "q5") ? getOptionIndexWithinQuestion(o) : null;

        if(q === "q1" || q === "q2" || q === "q3"){
          answers[q] = Q07_01_03_INDEX_TO_VALUE[idx] || '';
        } else if(q === "q4"){
          answers[q] = Q0704_INDEX_TO_VALUE[idx] || '';
        } else {
          answers[q] = a;
        }

        if(q !== "q5") answerIdx[q] = idx;
        setOptState(q, o);
        updateUnlock();
      };
      o.addEventListener('click', act);
      o.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); act(); }
      });
    });

    unlockBtn.addEventListener('click', ()=>{
      const r = computeArchetype();
      const emblemEl = document.getElementById("archetypeEmblem");
      if (emblemEl) emblemEl.src = emblemMap[currentTheme] || "";

      archTitle.textContent = r.zh;
      archKey.textContent   = r.key;
      archCore.textContent  = r.core;
      applyResultCopy(r.archetypeKey, r.bias);
      if(archPicked) archPicked.textContent = r.zh;

      setTimeout(()=>{
        const s7 = document.getElementById('s7');
        if(s7) s7.scrollIntoView({behavior:'smooth', block:'start'});
        setTimeout(requestCheck, 180);
      }, 260);
    });

    $('#toHearthBtn').addEventListener('click', ()=>{
      const s8 = document.getElementById('s8');
      if(s8) s8.scrollIntoView({behavior:'smooth', block:'start'});
      setTimeout(requestCheck, 180);
    });

    /* =========================
       Form Submission
       ========================= */
    const iframe = $('#hidden_iframe');
    let submittedAt = 0;

    function submitGForm(e){
      const input = $('#email');
      const email = (input.value||'').trim();
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
        alert('請輸入有效的 Email');
        return false;
      }

      const pretone = (localStorage.getItem('hestia_pretone') || '').toUpperCase();
      const v06 = currentTheme || '';
      
      $('#f_pretone').value = pretone;
      $('#f_06').value      = v06;
      $('#f_0701').value = answers.q1 || '';
      $('#f_0702').value = answers.q2 || '';
      $('#f_0703').value = answers.q3 || '';
      $('#f_0704').value = answers.q4 || '';
      $('#f_0705').value = answers.q5 || '';

      submittedAt = Date.now();
      castSparkFromElement($('#tendBtn'));
      setCount(getCount()+1);
      applyLevel();
      return true;
    }

    iframe.addEventListener('load',()=>{
      if(Date.now()-submittedAt<350) return;
      $('#email').value='';
      showToast('訂閱成功！我們將在第一時間通知你最新消息。', 2600);
    });

    /* Dots Logic */
    const sectionIds = ['s1','s1b','s2','s3','s4b','s4','s5','s6','s7','s8'];
    const sections = sectionIds.map(id=>document.getElementById(id));
    const dots = $$('.dot');

    function setActiveDot(idx){ dots.forEach((d,i)=>d.classList.toggle('active', i===idx)); }

    let lastActive = 0;
    function updateActiveDot(){
      const vh = window.innerHeight;
      let best = {idx:0, score:999999};
      sections.forEach((sec, idx)=>{
        if(!sec) return;
        const r = sec.getBoundingClientRect();
        const center = r.top + r.height/2;
        const score = Math.abs(center - vh/2);
        if(score < best.score) best = {idx, score};
      });
      setActiveDot(best.idx);
      if(best.idx !== lastActive){
        breath.classList.add('transition');
        requestAnimationFrame(()=>{
          breath.classList.add('release');
          setTimeout(()=>breath.classList.remove('transition','release'), 620);
        });
        lastActive = best.idx;
      }
    }

    dots.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-target');
        const target = document.getElementById(id);
        if(!target) return;
        target.scrollIntoView({behavior:'smooth', block:'start'});
      }, {passive:true});
    });

    const dotsNav = $('#dotsNav');
    function onFirstScroll(){
      dotsNav.classList.add('hint');
      setTimeout(()=>dotsNav.classList.remove('hint'), 1200);
      window.removeEventListener('scroll', onFirstScroll, {passive:true});
    }
    window.addEventListener('scroll', onFirstScroll, {passive:true});

    function extraTick(){ updateActiveDot(); }
    window.addEventListener('scroll', ()=>{ requestAnimationFrame(extraTick); }, {passive:true});
    window.addEventListener('load', ()=>{
      requestAnimationFrame(extraTick);
      setTimeout(()=>requestAnimationFrame(extraTick), 240);
    });
    window.addEventListener('resize', ()=>requestAnimationFrame(extraTick));

    /* =========================
       Collective Hearth (Canvas)
       ========================= */
    const canvas = $('#flameCanvas');
    const ctx = canvas.getContext('2d', { alpha:true });
    let W=0,H=0, dpr=1;

    function resizeCanvas(){
      const rect = canvas.getBoundingClientRect();
      dpr = Math.min(2, window.devicePixelRatio || 1);
      W = Math.floor(rect.width * dpr);
      H = Math.floor(rect.height * dpr);
      canvas.width = W; canvas.height = H;
    }
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('load', resizeCanvas);
    resizeCanvas();

    const particles = [];
    let running = true;
    let boost = 0;
    let globalIntensity = 1.0;

    const HEARTH_KEY = 'hestia_hearth_count';
    const HEARTH_LEVEL_KEY = 'hestia_hearth_level';
    const hearthLevelEl = $('#hearthLevel');
    let levelBoost = 0;

    function getCount(){ return parseInt(localStorage.getItem(HEARTH_KEY) || '37', 10); }
    function setCount(n){ localStorage.setItem(HEARTH_KEY, String(n)); }

    function levelFromCount(n){
      if(n < 50) return 'Ember';
      if(n < 150) return 'Glow';
      if(n < 350) return 'Warmth';
      if(n < 700) return 'Hearth';
      return 'Flame';
    }

    function showHearthToast(from, to){
      const msg = {
        Ember:  '火種被更多人守住了。',
        Glow:   '微光開始聚集。',
        Warmth: '溫度正在形成。',
        Hearth: '爐火已穩定燃燒。',
        Flame:  '這裡成為真正的火焰。'
      };
      showToast(`HEARTH UPGRADED｜${to.toUpperCase()} — ${msg[to] || ''}`, 3200);
    }

    function applyLevel(){
      const n = getCount();
      const newLevel = levelFromCount(n);
      const prevLevel = localStorage.getItem(HEARTH_LEVEL_KEY);
      if(hearthLevelEl) hearthLevelEl.textContent = newLevel;
      if(prevLevel && prevLevel !== newLevel){
        showHearthToast(prevLevel, newLevel);
        levelBoost = 1.0;
        setTimeout(()=> levelBoost = 0, 1200);
      }
      localStorage.setItem(HEARTH_LEVEL_KEY, newLevel);
      const base = (n < 50) ? 0.92 : (n < 150) ? 0.98 : (n < 350) ? 1.04 : (n < 700) ? 1.10 : 1.16;
      globalIntensity = base;
    }
    applyLevel();

    function addParticle(x, y, vx, vy, life, size, hue){
      particles.push({x,y,vx,vy,life,maxLife:life,size,hue});
    }

    function spawnBase(){
      const baseX = W * 0.5;
      const baseY = H * 0.82;
      for(let i=0;i<6;i++){
        const spread = (0.20 + Math.random()*0.18) * W * 0.12;
        const x = baseX + (Math.random()*2-1) * spread;
        const y = baseY + (Math.random()*2-1) * (H*0.006);
        const vx = (Math.random()*2-1) * (W*0.00025);
        const vy = -(H*0.0012 + Math.random() * H*0.0016);
        const life = 56 + Math.random()*42;
        const size = (1.4 + Math.random()*2.4) * dpr;
        const hue = 18 + Math.random()*28; // Original Orange Hue
        addParticle(x,y,vx,vy,life,size,hue);
      }
    }

    function draw(){
      if(!running) return;
      boost = Math.max(boost, levelBoost);
      boost *= 0.92;
      ctx.clearRect(0,0,W,H);

      const gx = W*0.5, gy = H*0.86;
      const g = ctx.createRadialGradient(gx,gy,0,gx,gy,H*0.42);
      const b = 0.10 + boost*0.06;
      g.addColorStop(0, `rgba(255,106,42,${0.12*globalIntensity + b})`);
      g.addColorStop(0.45, `rgba(255,175,90,${0.08*globalIntensity + b*0.6})`);
      g.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);

      spawnBase();

      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.life -= 1;
        if(p.life <= 0){ particles.splice(i,1); continue; }

        const t = 1 - p.life/p.maxLife;
        const cx = W*0.5;
        p.vx += (cx - p.x) * (W*0.00000010);
        p.x += p.vx;
        p.y += p.vy;
        p.vy *= 0.995;
        p.vx *= 0.996;

        const a = (1 - t) * 0.26 * globalIntensity + boost*0.04;
        const size = p.size * (1.0 + t*0.55);

        ctx.beginPath();
        ctx.fillStyle = `hsla(${p.hue}, 82%, ${56 + t*10}%, ${Math.max(0, a)})`;
        ctx.arc(p.x, p.y, size, 0, Math.PI*2);
        ctx.fill();
      }
      if(particles.length > 520) particles.splice(0, particles.length-520);
      requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);

    function castSparkFromElement(el){
      if(!el) return;
      const r = el.getBoundingClientRect();
      const c = canvas.getBoundingClientRect();
      const startX = (r.left + r.width*0.5 - c.left) * dpr;
      const startY = (r.top + r.height*0.5 - c.top) * dpr;
      const targetX = W*0.5;
      const targetY = H*0.80;

      for(let i=0;i<32;i++){
        const dx = (targetX - startX);
        const dy = (targetY - startY);
        const vx = dx * (0.008 + Math.random()*0.004) + (Math.random()*2-1)*W*0.0006;
        const vy = dy * (0.010 + Math.random()*0.004) - Math.random()*H*0.002;
        addParticle(startX, startY, vx, vy, 34 + Math.random()*18, (1.6+Math.random()*2.2)*dpr, 330 + Math.random()*20);
      }
      boost = Math.min(1.2, boost + 0.85);
    }

    /* Sanctuary Guide Logic */
    const s4a = document.getElementById('s4a');
    const gcSteps = [
      document.getElementById('gc1'), document.getElementById('gc2'),
      document.getElementById('gc3'), document.getElementById('gc4'),
      document.getElementById('gc5'), document.getElementById('gc6'),
      document.getElementById('gc7')
    ].filter(Boolean);

    let guideBusy = false, guidePlayed = false, guideAbort = false;

    function resetGuideSteps(){
      gcSteps.forEach(el => el.classList.remove('show','hide'));
    }

    async function playGuideAuto(){
      if(guideBusy || guidePlayed || !s4a) return;
      guideBusy = true; guideAbort = false;
      resetGuideSteps();

      const slow = 1.55;
      const showDur = [1500,1350,1350,1350,1500,900].map(v => v * slow);
      const gapDur  = 560 * slow;

      for(let i=0;i<gcSteps.length;i++){
        if(guideAbort) break;
        const el = gcSteps[i];
        if(!el) continue;
        el.classList.add('show');
        await sleep(showDur[i] || (1400*slow));
        if(guideAbort) break;
        if(i === gcSteps.length - 1) break;
        el.classList.remove('show');
        el.classList.add('hide');
        await sleep(gapDur);
      }
      guideBusy = false; guidePlayed = true;
    }

    function guideInView(){ return inView(s4a, 0.78, 0.18); }

    function guideWatcher(){
      if(!s4a) return;
      if(guideInView()){ playGuideAuto(); } else { guideAbort = true; }
    }

    window.addEventListener('scroll', guideWatcher, { passive:true });
    window.addEventListener('load', guideWatcher);
    window.addEventListener('resize', guideWatcher);
    setTimeout(guideWatcher, 120);
  </script>
</body>
</html>
