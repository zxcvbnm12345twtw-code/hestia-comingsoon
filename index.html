<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <!-- Favicon -->
  <link rel="icon" href="/favicon.png" type="image/png" sizes="32x32" />
  <link rel="icon" href="/favicon.png" type="image/png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/favicon.png" />

  <title>HESTIA TAIWAN｜健身休閒服飾</title>
  <meta name="description" content="HESTIA 健身時尚品牌，融合時尚與力量優雅，讓每個人穿出屬於自己的火焰。Own Your Flame.">
  <meta name="keywords" content="Hestia, 健身, 健身時尚服飾, 運動休閒服飾, 台灣品牌">
  <meta property="og:title" content="HESTIA TAIWAN｜健身時尚品牌">
  <meta property="og:description" content="Own Your Flame. 不只是運動，更是自我認同。">
  <meta property="og:url" content="https://www.hestiatw.com/">
  <meta property="og:type" content="website">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      /* 基礎（默認：餘燼 Ember） */
      --bg0:#070608;
      --bg1:#120b0f;
      --bg2:#1a1016;
      --card: rgba(255,255,255,.045);
      --card2: rgba(255,255,255,.025);
      --hair: rgba(255,255,255,.12);
      --hair2: rgba(255,255,255,.08);
      --text: rgba(255,255,255,.86);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.55);

      /* 主色：沉靜火色系（可被投票改寫） */
      --accent:#E67690;        /* 你原本的粉 */
      --ember:#B86B52;         /* 赤陶 */
      --amber:#C18A4A;         /* 深琥珀 */
      --sage:#7E9C8E;          /* 鼠尾草 */
      --stone:#D8D1C6;         /* 米白 */
      --midnight:#2B3B4A;      /* 岩石深海 */
      --charcoal:#0B0B0F;

      /* 目前主題（由投票控制） */
      --themeA: rgba(184,107,82,.22);
      --themeB: rgba(193,138,74,.14);
      --themeC: rgba(230,118,144,.10);
    }

    html,body{
      margin:0;padding:0;overflow-x:hidden;
      background: linear-gradient(180deg,var(--bg0),var(--bg1) 45%, var(--bg2));
      color:var(--text);
      font-family: ui-sans-serif,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",Arial,sans-serif;
    }

    /* 低噪音連結 */
    a{ color: rgba(255,255,255,.86); text-decoration:none; }
    a.under{ border-bottom:1px solid rgba(255,255,255,.22); padding-bottom:2px; }

    /* 背景呼吸（更克制、更像燭光） */
    .breath{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      opacity:.12; mix-blend-mode:screen;
      background:
        radial-gradient(120% 120% at 50% 120%, var(--themeA) 0%, rgba(0,0,0,0) 68%),
        radial-gradient(140% 100% at 50% -10%, var(--themeB) 0%, rgba(0,0,0,0) 72%),
        radial-gradient(90% 90% at 15% 25%, var(--themeC) 0%, rgba(0,0,0,0) 70%);
      animation:breathPulse 10s ease-in-out infinite alternate,breathDrift 30s ease-in-out infinite alternate;
      transform-origin: 50% 60%;
      will-change: transform, opacity, background-position;
    }
    @keyframes breathPulse{
      0%{opacity:.10; transform:scale(1);}
      50%{opacity:.14; transform:scale(1.02);}
      100%{opacity:.10; transform:scale(1);}
    }
    @keyframes breathDrift{
      0%{background-position:50% 120%,50% -10%,15% 25%;}
      100%{background-position:48% 108%,52% 0%,20% 30%;}
    }

    /* 柔粒 */
    .grain{
      position:fixed; inset:0; pointer-events:none; z-index:1;
      opacity:.055; mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      background-size: 240px 240px;
      transform: translateZ(0);
    }

    /* Layout：手機優先，單欄、聚焦中央 */
    .wrap{
      position:relative; z-index:2;
      width: min(760px, 92vw);
      margin: 0 auto;
      padding: 72px 0;
    }

    section{
      padding: 42px 0;
      scroll-margin-top: 10px;
    }

    h1,h2,h3{ margin:0; color:#fff; }
    h1{
      font-size: clamp(30px, 6.5vw, 52px);
      letter-spacing:.02em;
      line-height:1.06;
    }
    h2{
      font-size: clamp(22px, 5.4vw, 38px);
      letter-spacing:.02em;
      line-height:1.10;
    }
    h3{
      font-size: clamp(16px, 4.2vw, 20px);
      color: rgba(255,255,255,.88);
      letter-spacing:.08em;
      font-weight:600;
    }
    p{
      margin: 12px 0 0;
      font-size: clamp(15px, 4.1vw, 18px);
      line-height:1.72;
      color: var(--text);
    }
    .muted{ color: var(--muted); }
    .muted2{ color: var(--muted2); }

    .kicker{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      font-size:11px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color:rgba(255,255,255,.68);
      user-select:none;
    }
    .hair-underline{
      display:inline-block;
      padding-bottom:2px;
      background-image: linear-gradient(transparent calc(100% - 1px), rgba(255,255,255,.22) 1px);
      background-repeat: no-repeat;
      background-size: 100% 100%;
    }
    .we-accent{
      color: var(--accent);
      text-shadow: 0 0 22px rgba(230,118,144,.18);
    }

    /* 卡片：數位聖所風格 */
    .card{
      margin-top: 16px;
      padding: 18px 16px;
      border-radius: 20px;
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 60px rgba(0,0,0,.48);
      backdrop-filter: blur(7px);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(18px 18px at 16% 22%, rgba(255,255,255,.06), rgba(255,255,255,0) 70%),
        radial-gradient(22px 22px at 82% 68%, rgba(255,255,255,.05), rgba(255,255,255,0) 72%),
        linear-gradient(90deg, rgba(255,255,255,.05), rgba(255,255,255,0) 28%, rgba(255,255,255,0) 72%, rgba(255,255,255,.04));
      opacity:.55;
      pointer-events:none;
    }
    .card > *{ position:relative; z-index:2; }

    /* Hero：品牌中心（向心性） */
    .hero{
      padding-top: 16px;
      padding-bottom: 52px;
      text-align:center;
    }
    .brand{
      display:flex; flex-direction:column; align-items:center;
      gap: 10px;
    }
    .wordmark{
      width: min(560px, 86vw);
      filter: drop-shadow(0 10px 28px rgba(0,0,0,.58));
    }
    .submark{
      letter-spacing:.36em;
      font-size: clamp(14px, 4.6vw, 22px);
      font-weight:450;
      color: rgba(255,255,255,.86);
      opacity:.9;
      margin-top: -2px;
    }

    /* 微光宣言 */
    .oracle{
      margin-top: 16px;
      letter-spacing:.20em;
      font-size: clamp(12px, 3.7vw, 14px);
      color: rgba(255,255,255,.72);
      text-shadow: 0 0 14px rgba(230,118,144,.18);
      animation: oracleBreath 7.5s ease-in-out infinite;
    }
    @keyframes oracleBreath{
      0%,100%{opacity:.55;}
      50%{opacity:.95;}
    }

    /* 分段「慢揭示」 */
    .reveal{
      opacity:0;
      transform: translateY(18px);
      transition: opacity .85s cubic-bezier(.22,.61,.36,1),
                  transform .85s cubic-bezier(.22,.61,.36,1);
      will-change: opacity, transform;
    }
    .reveal.in{ opacity:1; transform:none; }

    /* 模組標題行 */
    .mod-head{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-top: 12px;
    }

    /* 章節導航：極小、右側、可關閉（手機也可用） */
    .dots{
      position:fixed;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      flex-direction:column;
      gap:12px;
      z-index:40;
      pointer-events:auto;
    }
    .dot{
      width:6px;height:6px;border-radius:50%;
      border:1px solid rgba(255,255,255,.58);
      background:transparent;
      padding:0;
      cursor:pointer;
      outline:none;
      appearance:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .18s ease, opacity .18s ease, background .18s ease, border-color .18s ease, box-shadow .18s ease;
      opacity:.55;
      position:relative;
    }
    .dot.active{
      opacity:1;
      background:#fff;
      border-color:#fff;
      box-shadow: 0 0 10px rgba(255,255,255,.50), 0 0 22px rgba(255,255,255,.22);
      animation: dotBreath 2.4s ease-in-out infinite;
    }
    @keyframes dotBreath{
      0%,100%{ box-shadow: 0 0 8px rgba(255,255,255,.34), 0 0 16px rgba(255,255,255,.16); transform: scale(1); }
      50%{     box-shadow: 0 0 12px rgba(255,255,255,.56), 0 0 26px rgba(255,255,255,.24); transform: scale(1.08); }
    }
    .dot::after{
      content: attr(data-label);
      position:absolute;
      right: 14px;
      top:50%;
      transform: translateY(-50%);
      padding:6px 8px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.55);
      box-shadow: 0 12px 40px rgba(0,0,0,.45);
      color: rgba(255,255,255,.84);
      font-size:11px;
      letter-spacing:.12em;
      white-space:nowrap;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      transform-origin: 100% 50%;
    }
    .dot:hover::after, .dot:focus-visible::after, .dot.showtip::after{
      opacity:1;
      transform: translateY(-50%) translateX(-2px);
    }

    /* 右上角：安靜開關（聲音／動態） */
    .topbar{
      position:fixed; top:14px; left:50%;
      transform:translateX(-50%);
      width:min(760px, 92vw);
      display:flex; align-items:center; justify-content:space-between;
      z-index:50;
      pointer-events:none;
    }
    .toggles{
      margin-left:auto;
      display:flex; gap:10px;
      pointer-events:auto;
    }
    .pill{
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      box-shadow: 0 12px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
      color: rgba(255,255,255,.82);
      padding:10px 12px;
      font-size:12px;
      letter-spacing:.10em;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      display:inline-flex;
      align-items:center;
      gap:8px;
      backdrop-filter: blur(8px);
    }
    .pill:active{ transform: scale(.99); }
    .pill .state{ opacity:.72; font-size:11px; }

    /* Collective Hearth（Canvas 與框） */
    .hearth{
      margin-top: 14px;
      padding: 14px 14px 16px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(120% 120% at 50% 25%, rgba(255,255,255,.06), rgba(255,255,255,0) 62%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      box-shadow: 0 22px 72px rgba(0,0,0,.52);
      overflow:hidden;
      position:relative;
    }
    .hearth::after{
      content:"";
      position:absolute; inset:12px;
      border-radius:18px;
      border: 1px solid rgba(255,255,255,.06);
      pointer-events:none;
      opacity:.85;
    }
    .hearth-top{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin-bottom: 10px;
    }
    .hearth-copy p{ margin-top: 8px; }
    .hearth-meta{
      text-align:right;
      color: rgba(255,255,255,.68);
      font-size:12px;
      letter-spacing:.08em;
      user-select:none;
      white-space:nowrap;
    }
    .hearth-meta .n{
      display:block;
      font-size:13px;
      color: rgba(255,255,255,.84);
      letter-spacing:.12em;
      margin-top: 2px;
    }
    canvas#flameCanvas{
      width: 100%;
      height: 260px; /* 手機高度 */
      display:block;
      border-radius: 16px;
      background:
        radial-gradient(120% 90% at 50% 70%, rgba(230,118,144,.10), rgba(0,0,0,0) 64%),
        radial-gradient(120% 110% at 50% 120%, rgba(193,138,74,.08), rgba(0,0,0,0) 70%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.22));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }

    /* 表單：安靜且儀式感 */
    .form{
      margin-top: 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .field{
      display:flex; gap:10px;
      align-items:stretch;
    }
    input[type="email"]{
      flex:1;
      padding: 14px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.96);
      color:#161616;
      outline:none;
      font-size:16px;
    }
    button{
      padding: 14px 14px;
      min-width: 132px;
      border:none;
      border-radius: 14px;
      background: var(--accent);
      color:#fff;
      font-size:15px;
      font-weight:800;
      letter-spacing:.06em;
      cursor:pointer;
      transition: filter .35s ease, transform .12s ease;
    }
    button:hover{ filter: brightness(.95); }
    button:active{ transform: scale(.99); }
    .small{
      margin-top: 8px;
      font-size:12px;
      color: rgba(255,255,255,.62);
      letter-spacing:.08em;
    }

    /* Aesthetic Voting：三張意境卡 */
    .moods{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 14px;
    }
    .mood{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background:
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 18px 60px rgba(0,0,0,.48);
      overflow:hidden;
      position:relative;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .22s ease, border-color .22s ease, box-shadow .22s ease, opacity .22s ease;
    }
    .mood:active{ transform: scale(.99); }
    .mood:hover{ border-color: rgba(255,255,255,.14); }
    .mood.dim{ opacity:.52; }
    .mood.active{
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 18px 66px rgba(0,0,0,.54), 0 0 26px rgba(230,118,144,.10);
    }
    .mood .img{
      height: 118px; /* 手機尺寸 */
      background-size: cover;
      background-position: center;
      filter: saturate(.92) contrast(1.02);
    }
    /* 用 CSS 生成意境（不依賴外部圖） */
    .mood[data-theme="dawn"] .img{
      background-image:
        radial-gradient(120% 120% at 30% 30%, rgba(255,255,255,.14), rgba(0,0,0,0) 58%),
        linear-gradient(135deg, rgba(126,156,142,.30), rgba(43,59,74,.20)),
        radial-gradient(120% 120% at 60% 70%, rgba(0,0,0,.35), rgba(0,0,0,0) 60%);
    }
    .mood[data-theme="ember"] .img{
      background-image:
        radial-gradient(120% 120% at 30% 30%, rgba(255,255,255,.12), rgba(0,0,0,0) 58%),
        linear-gradient(135deg, rgba(184,107,82,.34), rgba(193,138,74,.16)),
        radial-gradient(120% 120% at 60% 70%, rgba(0,0,0,.38), rgba(0,0,0,0) 60%);
    }
    .mood[data-theme="stone"] .img{
      background-image:
        radial-gradient(120% 120% at 35% 30%, rgba(255,255,255,.12), rgba(0,0,0,0) 58%),
        linear-gradient(135deg, rgba(43,59,74,.30), rgba(11,11,15,.42)),
        radial-gradient(120% 120% at 60% 70%, rgba(0,0,0,.45), rgba(0,0,0,0) 60%);
    }
    .mood .body{
      padding: 12px 14px 14px;
    }
    .mood .title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-top: 2px;
    }
    .mood .tag{
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(255,255,255,.70);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding:6px 8px;
      border-radius:999px;
    }

    /* Reflection：三題小測驗 */
    .quiz{
      margin-top: 14px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .q{
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
      box-shadow: 0 16px 54px rgba(0,0,0,.45);
    }
    .q .qt{
      font-size: 13px;
      letter-spacing:.06em;
      color: rgba(255,255,255,.80);
      margin-bottom: 10px;
      line-height:1.5;
    }
    .opts{ display:flex; flex-direction:column; gap:8px; }
    .opt{
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.82);
      padding: 12px 12px;
      font-size: 14px;
      letter-spacing:.04em;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .18s ease, border-color .18s ease, opacity .18s ease, box-shadow .18s ease;
    }
    .opt:active{ transform: scale(.995); }
    .opt.sel{
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 18px rgba(230,118,144,.10);
    }

    .result{
      margin-top: 12px;
      padding: 16px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: radial-gradient(120% 120% at 50% 0%, rgba(255,255,255,.05), rgba(255,255,255,.015) 60%),
                  linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      box-shadow: 0 18px 62px rgba(0,0,0,.46);
      display:none;
    }
    .result.show{ display:block; }

    /* Kit：解鎖後的柔和清單 */
    .kit{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    .kit a{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 14px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      box-shadow: 0 16px 54px rgba(0,0,0,.38);
    }
    .kit .k{
      font-size:12px;
      letter-spacing:.16em;
      text-transform:uppercase;
      color: rgba(255,255,255,.70);
    }
    .kit .v{
      font-size:13px;
      color: rgba(255,255,255,.84);
      letter-spacing:.06em;
      white-space:nowrap;
    }

    /* 品牌識別展示（安靜呈現） */
    .marks{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }
    .markbox{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(140% 120% at 50% 0%, rgba(255,255,255,.055), rgba(255,255,255,.015) 62%),
        linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      box-shadow: 0 18px 60px rgba(0,0,0,.46);
      display:grid;
      place-items:center;
      padding: 14px;
      overflow:hidden;
      position:relative;
    }
    .markbox img{
      width: min(140px, 30vw);
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.66));
      opacity:.95;
    }
    .markcap{
      margin-top: 8px;
      font-size: 11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color: rgba(255,255,255,.62);
      text-align:center;
    }

    /* Footer links */
    .links{
      margin-top: 14px;
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      justify-content:center;
    }

    /* Toast */
    .toast{
      position:fixed; left:50%; bottom:26px; transform:translateX(-50%);
      background:rgba(0,0,0,.74);
      padding:12px 16px;
      border-radius:12px;
      font-size:14px;
      box-shadow:0 10px 40px rgba(0,0,0,.45);
      opacity:0;
      pointer-events:none;
      transition:opacity .28s ease;
      z-index:99;
      color:rgba(255,255,255,.88);
      max-width: 86vw;
      text-align:center;
    }
    .toast.show{ opacity:1; }

    /* Loading Ritual Overlay */
    .loader{
      position:fixed; inset:0;
      background: radial-gradient(120% 120% at 50% 70%, rgba(230,118,144,.10), rgba(0,0,0,0) 62%),
                  linear-gradient(180deg, #000, #08060a 60%, #0b0a0f);
      z-index:999;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px;
      transition: opacity .55s ease, visibility .55s ease;
    }
    .loader.hide{
      opacity:0;
      visibility:hidden;
    }
    .loader-inner{
      width:min(520px, 92vw);
      text-align:center;
    }
    .spark{
      width: 10px;
      height: 10px;
      margin: 0 auto 18px;
      border-radius: 50%;
      background: rgba(255,255,255,.88);
      box-shadow:
        0 0 0 0 rgba(230,118,144,.22),
        0 0 18px rgba(230,118,144,.22);
      animation: sparkGrow 1.9s ease-in-out infinite;
    }
    @keyframes sparkGrow{
      0%{ transform: scale(.90); box-shadow: 0 0 0 0 rgba(230,118,144,.10), 0 0 12px rgba(230,118,144,.18);}
      50%{ transform: scale(1.25); box-shadow: 0 0 0 22px rgba(230,118,144,.06), 0 0 26px rgba(230,118,144,.22);}
      100%{ transform: scale(.90); box-shadow: 0 0 0 0 rgba(230,118,144,.10), 0 0 12px rgba(230,118,144,.18);}
    }
    .loader-title{
      font-size: 12px;
      letter-spacing:.22em;
      text-transform: uppercase;
      color: rgba(255,255,255,.78);
      margin-bottom: 10px;
    }
    .loader-sub{
      font-size: 14px;
      color: rgba(255,255,255,.70);
      letter-spacing:.06em;
      line-height:1.65;
    }

    /* 無障礙：減少動態 */
    @media (prefers-reduced-motion: reduce){
      .breath,.grain,.oracle,.dot.active,.spark{ animation:none !important; }
      .reveal{ transition:none !important; }
      .loader{ transition:none !important; }
    }

    /* 小螢幕微調 */
    @media (max-width: 360px){
      button{ min-width: 118px; }
      canvas#flameCanvas{ height: 240px; }
    }

    /* 大螢幕：兩欄 mood / kit */
    @media (min-width: 740px){
      .moods{ grid-template-columns: 1fr 1fr 1fr; }
      .mood .img{ height: 140px; }
      canvas#flameCanvas{ height: 300px; }
      .kit{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>

<body>
  <div class="breath" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>

  <!-- Loading Ritual -->
  <div class="loader" id="loader" role="status" aria-live="polite">
    <div class="loader-inner">
      <div class="spark" aria-hidden="true"></div>
      <div class="loader-title">Kindling</div>
      <div class="loader-sub">點燃中…<br>請慢慢呼吸一下。</div>
    </div>
  </div>

  <!-- Topbar Toggles -->
  <div class="topbar" aria-hidden="false">
    <div class="toggles">
      <button class="pill" id="motionToggle" type="button" aria-label="Toggle motion">
        動態 <span class="state" id="motionState">ON</span>
      </button>
      <button class="pill" id="soundToggle" type="button" aria-label="Toggle sound">
        聲音 <span class="state" id="soundState">OFF</span>
      </button>
    </div>
  </div>

  <!-- Dots Nav -->
  <nav class="dots" id="dotsNav" aria-label="Section navigation">
    <button class="dot" data-target="origin" data-label="ORIGIN" aria-label="Go to Origin"></button>
    <button class="dot" data-target="ritual" data-label="RITUAL" aria-label="Go to Ritual"></button>
    <button class="dot" data-target="promise" data-label="PROMISE" aria-label="Go to Promise"></button>
  </nav>

  <main class="wrap">
    <!-- HERO / ORIGIN -->
    <section class="hero" id="origin">
      <div class="brand reveal">
        <img class="wordmark" src="wordmark.png" alt="HESTIA wordmark" />
        <div class="submark">TAIWAN</div>
      </div>

      <div class="card reveal" style="margin-top:18px;">
        <div class="mod-head">
          <span class="kicker">Digital Sanctuary</span>
          <span class="muted2" style="font-size:12px; letter-spacing:.10em;">Gathering Warmth</span>
        </div>

        <h1 style="margin-top:12px;">
          你不需要更像誰。<br>
          你只需要更像你。
        </h1>

        <p class="muted">
          HESTIA 以爐灶女神之名，守護<span class="hair-underline">內在之火</span>、<span class="hair-underline">歸屬</span>與<span class="hair-underline">節制的力量</span>。
          這裡不是倒數頁，而是一座讓你安靜參與品牌誕生的聖所。
        </p>

        <div class="marks">
          <div>
            <div class="markbox">
              <img src="Hlogo.png" alt="HESTIA Primary Mark">
            </div>
            <div class="markcap">PRIMARY MARK</div>
          </div>
          <div>
            <div class="markbox">
              <img src="Flamemark.png" alt="HESTIA Flame Mark">
            </div>
            <div class="markcap">FLAME MARK</div>
          </div>
        </div>

        <p class="oracle">Own Your Flame.</p>
      </div>
    </section>

    <!-- RITUAL -->
    <section id="ritual">
      <div class="reveal">
        <span class="kicker">The Ritual</span>
        <h2 style="margin-top:14px;">靜謐參與</h2>
        <p class="muted">
          這裡的互動不追求刺激，而是<span class="hair-underline">共感</span>。你每一次的停留與選擇，都會成為聖火的一部分。
        </p>
      </div>

      <!-- (1) Collective Hearth -->
      <div class="hearth reveal" id="hearthBlock">
        <div class="hearth-top">
          <div class="hearth-copy">
            <h3>集體爐火 · The Collective Hearth</h3>
            <p class="muted">
              不用搶先，只要守護。<br>
              把你的光點，投入爐火。
            </p>
          </div>
          <div class="hearth-meta" aria-label="Hearth status">
            <span class="muted2">HEARTH</span>
            <span class="n" id="hearthLevel">Ember</span>
          </div>
        </div>

        <canvas id="flameCanvas" aria-label="Collective hearth flame"></canvas>

        <div class="form" style="position:relative; z-index:2;">
          <form id="notify"
                action="https://docs.google.com/forms/d/e/1FAIpQLSfmk4ZgMlWpAbFKa6x1JNAq0hwn6kzXtOoB9e9nIbZxsAuNTA/formResponse"
                method="POST" target="hidden_iframe" autocomplete="off">
            <div class="field">
              <input id="email" type="email" name="entry.345729382" placeholder="輸入 Email（守火者名單）" required />
              <button type="submit" id="tendBtn">投入爐火</button>
            </div>
          </form>
          <div class="small">
            我們不寄噪音。只在必要時寄出「信箋」。
          </div>
        </div>

        <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>
      </div>

      <!-- (2) Aesthetic Alignment Voting -->
      <div class="card reveal" style="margin-top:16px;">
        <div class="mod-head">
          <span class="kicker">Aesthetic Alignment</span>
          <span class="muted2" style="font-size:12px; letter-spacing:.10em;">Slow Choice</span>
        </div>

        <h3 style="margin-top:12px;">你心中的聖所，是什麼色調？</h3>
        <p class="muted">選擇後，整個頁面的氛圍會慢慢改變，停留 5 秒，感受它。</p>

        <div class="moods" id="moods">
          <div class="mood" tabindex="0" role="button" data-theme="dawn" aria-label="Choose Dawn theme">
            <div class="img" aria-hidden="true"></div>
            <div class="body">
              <div class="title">
                <div>
                  <div style="font-weight:700; letter-spacing:.04em;">晨曦 · Dawn</div>
                  <div class="muted2" style="font-size:12px; margin-top:4px;">霧氣、森林、鼠尾草綠</div>
                </div>
                <span class="tag">SAGE</span>
              </div>
            </div>
          </div>

          <div class="mood active" tabindex="0" role="button" data-theme="ember" aria-label="Choose Ember theme">
            <div class="img" aria-hidden="true"></div>
            <div class="body">
              <div class="title">
                <div>
                  <div style="font-weight:700; letter-spacing:.04em;">餘燼 · Ember</div>
                  <div class="muted2" style="font-size:12px; margin-top:4px;">赤陶、深琥珀、溫熱光暈</div>
                </div>
                <span class="tag">AMBER</span>
              </div>
            </div>
          </div>

          <div class="mood" tabindex="0" role="button" data-theme="stone" aria-label="Choose Stone theme">
            <div class="img" aria-hidden="true"></div>
            <div class="body">
              <div class="title">
                <div>
                  <div style="font-weight:700; letter-spacing:.04em;">岩石 · Stone</div>
                  <div class="muted2" style="font-size:12px; margin-top:4px;">深海、石墨黑、靜謐冷光</div>
                </div>
                <span class="tag">MIDNIGHT</span>
              </div>
            </div>
          </div>
        </div>

        <p class="small" id="moodNote">你的選擇會被記住（只存在你的裝置，不做公開排名）。</p>
      </div>

      <!-- (3) Introspective Reflection -->
      <div class="card reveal" style="margin-top:16px;">
        <div class="mod-head">
          <span class="kicker">Introspective Reflection</span>
          <span class="muted2" style="font-size:12px; letter-spacing:.10em;">3 Questions</span>
        </div>

        <h3 style="margin-top:12px;">探索你的原型</h3>
        <p class="muted">不是分類銷售，而是給你一份安靜的鏡子。</p>

        <div class="quiz" id="quiz">
          <div class="q" data-q="1">
            <div class="qt">1) 當世界喧囂時，你更傾向於：</div>
            <div class="opts">
              <div class="opt" data-v="A">走進森林，讓呼吸回到身體</div>
              <div class="opt" data-v="B">點一盞燭光，把注意力收回中心</div>
              <div class="opt" data-v="C">靠近海面以下，讓思緒沉下來</div>
            </div>
          </div>

          <div class="q" data-q="2">
            <div class="qt">2) 你的力量更常來自於：</div>
            <div class="opts">
              <div class="opt" data-v="A">穩定的節奏與日常紀律</div>
              <div class="opt" data-v="B">溫柔但堅定的自我接納</div>
              <div class="opt" data-v="C">寂靜中的洞察與清晰</div>
            </div>
          </div>

          <div class="q" data-q="3">
            <div class="qt">3) 當你穿上運動服，你最在意的是：</div>
            <div class="opts">
              <div class="opt" data-v="A">讓狀態更好，但不喧嘩</div>
              <div class="opt" data-v="B">像自己，並且被自己喜歡</div>
              <div class="opt" data-v="C">安靜地撐住每一段長路</div>
            </div>
          </div>

          <button type="button" id="revealResult" style="margin-top:4px;">
            解鎖你的靜心包
          </button>

          <div class="result" id="result">
            <div class="kicker">Sanctuary Kit</div>
            <h3 style="margin-top:12px;" id="archetypeTitle">—</h3>
            <p class="muted" id="archetypeDesc">—</p>

            <div class="kit">
              <!-- 下面是佔位連結：你之後換成真素材即可 -->
              <a class="under" href="#" id="kitPlaylist" target="_blank" rel="noopener">
                <span>
                  <div class="k">Playlist</div>
                  <div class="v">Hestia Curated</div>
                </span>
                <span class="muted2">→</span>
              </a>
              <a class="under" href="#" id="kitWallpaper" target="_blank" rel="noopener">
                <span>
                  <div class="k">Wallpaper</div>
                  <div class="v">Mobile Sanctuary</div>
                </span>
                <span class="muted2">→</span>
              </a>
              <a class="under" href="#" id="kitAudio" target="_blank" rel="noopener">
                <span>
                  <div class="k">Audio</div>
                  <div class="v">5-min Calm Guide</div>
                </span>
                <span class="muted2">→</span>
              </a>
              <a class="under" href="#promise">
                <span>
                  <div class="k">Letters</div>
                  <div class="v">成為守火者</div>
                </span>
                <span class="muted2">→</span>
              </a>
            </div>

            <p class="small" style="margin-top:10px;">
              你可以先拿走靜心包，再決定要不要留下 Email。
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- PROMISE -->
    <section id="promise">
      <div class="card reveal">
        <div class="mod-head">
          <span class="kicker">The Promise</span>
          <span class="muted2" style="font-size:12px; letter-spacing:.10em;">Quiet Launch</span>
        </div>

        <h2 style="margin-top:12px;">我們會很快開始</h2>
        <p class="muted">
          HESTIA 不追逐喧囂，我們在意的是你回到中心的那一刻。<br>
          如果你願意，成為首批<span class="hair-underline">守火者</span>。
        </p>

        <div class="links">
          <a class="under" href="https://www.instagram.com/hestia.taiwan/" target="_blank" rel="noopener">Instagram</a>
          <a class="under" href="https://lin.ee/kjso8Ba" target="_blank" rel="noopener">LINE 官方帳號</a>
          <a class="under" href="#ritual">回到儀式</a>
        </div>

        <p class="small" style="margin-top:12px;">
          註：本頁不使用倒數焦慮。只有當「火焰準備好」時，我們才會點亮第一封信箋。
        </p>
      </div>

      <p class="muted2" style="text-align:center; margin-top:18px; font-size:12px; letter-spacing:.10em;">
        © HESTIA TAIWAN
      </p>
    </section>
  </main>

  <div class="toast" id="toast">已投入爐火。你的一點光，會留在這裡。</div>

  <script>
    /* =========================
       Utilities
    ========================== */
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    function inView(el, topRatio=0.82, bottomRatio=0.12){
      if(!el) return false;
      const r = el.getBoundingClientRect();
      const vh = window.innerHeight || document.documentElement.clientHeight;
      const topLine = vh * topRatio;
      const bottomLine = vh * bottomRatio;
      return (r.top <= topLine) && (r.bottom >= bottomLine);
    }

    /* =========================
       Loading Ritual
    ========================== */
    const loader = $('#loader');
    window.addEventListener('load', ()=>{
      // 讓載入儀式至少停留一個呼吸（避免閃一下）
      setTimeout(()=>loader.classList.add('hide'), 650);
    });

    /* =========================
       Motion Toggle (Manual)
       - 以 body 加上 reduced-motion 模擬降級
    ========================== */
    const motionToggle = $('#motionToggle');
    const motionState = $('#motionState');
    const MOTION_KEY = 'hestia_motion_off';

    function applyMotionPref(){
      const off = localStorage.getItem(MOTION_KEY) === '1';
      document.documentElement.classList.toggle('rm', off);
      if(off){
        // 強制停止動畫（用行內 style 避免改一堆 CSS）
        document.body.style.scrollBehavior = 'auto';
        motionState.textContent = 'OFF';
        // 對部分動態元素降級
        // breath/grain 仍可留著，但更安靜
        $('.breath')?.style.setProperty('animation', 'none');
      }else{
        motionState.textContent = 'ON';
        $('.breath')?.style.removeProperty('animation');
      }
    }
    motionToggle.addEventListener('click', ()=>{
      const off = localStorage.getItem(MOTION_KEY) === '1';
      localStorage.setItem(MOTION_KEY, off ? '0' : '1');
      applyMotionPref();
    });
    applyMotionPref();

    /* =========================
       Sound Toggle (Optional)
       - 不自動播放
       - 用極低干擾的微弱噪音（純 WebAudio 產生）
    ========================== */
    const soundToggle = $('#soundToggle');
    const soundState = $('#soundState');
    let audioCtx = null;
    let noiseNode = null;
    let gainNode = null;
    let soundOn = false;

    function createBrownNoise(ctx){
      // 簡易 brown noise（近似）：white -> integrate
      const bufferSize = 2 * ctx.sampleRate;
      const noiseBuffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
      const output = noiseBuffer.getChannelData(0);
      let lastOut = 0.0;
      for (let i = 0; i < bufferSize; i++) {
        const white = Math.random() * 2 - 1;
        output[i] = (lastOut + (0.02 * white)) / 1.02;
        lastOut = output[i];
        output[i] *= 3.5; // gain compensation
      }
      const node = ctx.createBufferSource();
      node.buffer = noiseBuffer;
      node.loop = true;
      return node;
    }

    async function enableSound(){
      if(soundOn) return;
      audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state === 'suspended') await audioCtx.resume();

      gainNode = audioCtx.createGain();
      gainNode.gain.value = 0.0;

      noiseNode = createBrownNoise(audioCtx);
      noiseNode.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      noiseNode.start();
      // 慢慢拉起，不造成驚嚇
      const now = audioCtx.currentTime;
      gainNode.gain.cancelScheduledValues(now);
      gainNode.gain.setValueAtTime(0.0, now);
      gainNode.gain.linearRampToValueAtTime(0.022, now + 1.2); // 非常小聲

      soundOn = true;
      soundState.textContent = 'ON';
    }

    function disableSound(){
      if(!soundOn) return;
      try{
        const now = audioCtx?.currentTime || 0;
        if(gainNode && audioCtx){
          gainNode.gain.cancelScheduledValues(now);
          gainNode.gain.setValueAtTime(gainNode.gain.value, now);
          gainNode.gain.linearRampToValueAtTime(0.0, now + 0.6);
        }
        setTimeout(()=>{
          try{ noiseNode?.stop(); }catch(e){}
          noiseNode = null;
          gainNode = null;
        }, 700);
      }catch(e){}
      soundOn = false;
      soundState.textContent = 'OFF';
    }

    soundToggle.addEventListener('click', ()=>{
      if(soundOn) disableSound();
      else enableSound();
    });

    /* =========================
       Reveal on scroll (Slow Reveal)
    ========================== */
    const revealEls = $$('.reveal');
    let ticking = false;

    function checkReveal(){
      ticking = false;
      revealEls.forEach(el=>{
        if(!el.classList.contains('in') && inView(el, 0.86, 0.06)){
          el.classList.add('in');
        }
      });
    }
    function requestCheck(){
      if(ticking) return;
      ticking = true;
      requestAnimationFrame(checkReveal);
    }
    window.addEventListener('scroll', requestCheck, {passive:true});
    window.addEventListener('resize', requestCheck);
    window.addEventListener('load', ()=>{
      requestCheck();
      setTimeout(requestCheck, 180);
      setTimeout(requestCheck, 520);
    });

    /* =========================
       Dots Navigation + Active state
    ========================== */
    const sections = ['origin','ritual','promise'].map(id=>document.getElementById(id));
    const dots = $$('.dot');

    function setActiveDot(idx){
      dots.forEach((d,i)=>d.classList.toggle('active', i===idx));
    }

    function updateActiveDot(){
      const vh = window.innerHeight;
      let best = {idx:0, score:999999};
      sections.forEach((sec, idx)=>{
        const r = sec.getBoundingClientRect();
        const center = r.top + r.height/2;
        const score = Math.abs(center - vh/2);
        if(score < best.score) best = {idx, score};
      });
      setActiveDot(best.idx);
    }

    dots.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-target');
        const target = document.getElementById(id);
        if(!target) return;
        target.scrollIntoView({behavior:'smooth', block:'start'});
        setTimeout(requestCheck, 140);
        setTimeout(requestCheck, 520);
      });
    });

    // Tooltip long-press
    let pressTimer = null;
    dots.forEach(dot=>{
      const show = ()=>{
        dot.classList.add('showtip');
        setTimeout(()=>dot.classList.remove('showtip'), 900);
      };
      dot.addEventListener('pointerdown', ()=>{ pressTimer = setTimeout(show, 240); });
      dot.addEventListener('pointerup', ()=>{ if(pressTimer) clearTimeout(pressTimer); });
      dot.addEventListener('pointercancel', ()=>{ if(pressTimer) clearTimeout(pressTimer); });
      dot.addEventListener('pointerleave', ()=>{ if(pressTimer) clearTimeout(pressTimer); });
    });

    window.addEventListener('scroll', ()=>requestAnimationFrame(updateActiveDot), {passive:true});
    window.addEventListener('load', ()=>requestAnimationFrame(updateActiveDot));
    window.addEventListener('resize', ()=>requestAnimationFrame(updateActiveDot));

    /* =========================
       Aesthetic Alignment Voting
       - 慢慢改整站色調
       - 只存本機 localStorage
    ========================== */
    const moodWrap = $('#moods');
    const moodCards = $$('.mood', moodWrap);
    const MOOD_KEY = 'hestia_mood';

    function applyTheme(theme, slow=true){
      // 以 CSS 變數改變呼吸光與背景色調（沉靜漸變）
      const root = document.documentElement;
      const dur = slow ? 5200 : 800;

      root.style.transition = `--themeA ${dur}ms ease, --themeB ${dur}ms ease, --themeC ${dur}ms ease, background ${dur}ms ease`;
      // 用 setProperty 控制（不同 theme 的氛圍）
      if(theme === 'dawn'){
        root.style.setProperty('--themeA', 'rgba(126,156,142,.22)'); // sage
        root.style.setProperty('--themeB', 'rgba(43,59,74,.14)');    // midnight
        root.style.setProperty('--themeC', 'rgba(216,209,198,.07)'); // stone
        root.style.setProperty('--accent', '#7E9C8E');
      }else if(theme === 'stone'){
        root.style.setProperty('--themeA', 'rgba(43,59,74,.22)');
        root.style.setProperty('--themeB', 'rgba(11,11,15,.18)');
        root.style.setProperty('--themeC', 'rgba(184,107,82,.06)');
        root.style.setProperty('--accent', '#90A4B7'); // 冷靜金屬感（可改）
      }else{
        // ember default
        root.style.setProperty('--themeA', 'rgba(184,107,82,.22)');
        root.style.setProperty('--themeB', 'rgba(193,138,74,.14)');
        root.style.setProperty('--themeC', 'rgba(230,118,144,.10)');
        root.style.setProperty('--accent', '#E67690');
      }

      // 避免 transition 永久掛著
      setTimeout(()=>{ root.style.transition = ''; }, dur + 60);
    }

    function setMoodActive(theme){
      moodCards.forEach(c=>{
        const is = c.dataset.theme === theme;
        c.classList.toggle('active', is);
        c.classList.toggle('dim', !is);
      });
      setTimeout(()=>{
        // 回復非 dim（避免一直灰）
        moodCards.forEach(c=>c.classList.remove('dim'));
      }, 1200);
    }

    function chooseMood(theme){
      localStorage.setItem(MOOD_KEY, theme);
      setMoodActive(theme);
      applyTheme(theme, true);
    }

    moodCards.forEach(card=>{
      const theme = card.dataset.theme;
      card.addEventListener('click', ()=>chooseMood(theme));
      card.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          chooseMood(theme);
        }
      });
    });

    // init mood
    const savedMood = localStorage.getItem(MOOD_KEY) || 'ember';
    setMoodActive(savedMood);
    applyTheme(savedMood, false);

    /* =========================
       Collective Hearth (Canvas 2D)
       - 不用 WebGL，手機更穩
       - 火焰「等級」：依本機 session 的「守火者數」近似呈現（可換成真後端）
       - Email 提交：光點投射 -> 火焰瞬間增亮
    ========================== */
    const canvas = $('#flameCanvas');
    const ctx = canvas.getContext('2d', { alpha:true });
    let W=0,H=0, dpr=1;

    function resizeCanvas(){
      const rect = canvas.getBoundingClientRect();
      dpr = Math.min(2, window.devicePixelRatio || 1); // 保守，避免老手機爆
      W = Math.floor(rect.width * dpr);
      H = Math.floor(rect.height * dpr);
      canvas.width = W;
      canvas.height = H;
    }
    window.addEventListener('resize', resizeCanvas);
    window.addEventListener('load', resizeCanvas);
    resizeCanvas();

    // Particle system
    const particles = [];
    let running = true;
    let boost = 0; // 點火瞬間亮度
    let globalIntensity = 1.0;

    // 本機「hearth count」：只是示意（你未來可用後端取真數）
    const HEARTH_KEY = 'hestia_hearth_count';
    const hearthLevelEl = $('#hearthLevel');

    function getCount(){
      return parseInt(localStorage.getItem(HEARTH_KEY) || '37', 10); // 預設 37（看起來更像“有人守著”）
    }
    function setCount(n){
      localStorage.setItem(HEARTH_KEY, String(n));
    }
    function levelFromCount(n){
      // 閾值升級（符合你研究的「閾值更新」策略）
      if(n < 50) return 'Ember';
      if(n < 150) return 'Glow';
      if(n < 350) return 'Warmth';
      if(n < 700) return 'Hearth';
      return 'Flame';
    }
    function applyLevel(){
      const n = getCount();
      hearthLevelEl.textContent = levelFromCount(n);
      // 基礎強度隨等級略增，但仍克制
      const base = (n < 50) ? 0.92 :
                   (n < 150) ? 0.98 :
                   (n < 350) ? 1.04 :
                   (n < 700) ? 1.10 : 1.16;
      globalIntensity = base;
    }
    applyLevel();

    function addParticle(x, y, vx, vy, life, size, hue){
      particles.push({x,y,vx,vy,life,maxLife:life,size,hue});
    }

    function spawnBase(){
      // 在底部中心生成粒子（像燭火）
      const baseX = W * 0.5;
      const baseY = H * 0.82;
      const n = 6; // 每幀生成數（輕量）
      for(let i=0;i<n;i++){
        const spread = (0.20 + Math.random()*0.18) * W * 0.12;
        const x = baseX + (Math.random()*2-1) * spread;
        const y = baseY + (Math.random()*2-1) * (H*0.006);
        const vx = (Math.random()*2-1) * (W*0.00025);
        const vy = -(H*0.0012 + Math.random() * H*0.0016);
        const life = 56 + Math.random()*42;
        const size = (1.4 + Math.random()*2.4) * dpr;
        const hue = 18 + Math.random()*28; // amber-ish
        addParticle(x,y,vx,vy,life,size,hue);
      }
    }

    function draw(){
      if(!running) return;

      // 自然衰退 boost
      boost *= 0.92;

      // 背景擦拭（保留些微殘影）
      ctx.clearRect(0,0,W,H);

      // 柔和底光（火焰底座）
      const gx = W*0.5, gy = H*0.86;
      const g = ctx.createRadialGradient(gx,gy,0,gx,gy,H*0.42);
      const b = 0.10 + boost*0.06;
      g.addColorStop(0, `rgba(230,118,144,${0.12*globalIntensity + b})`);
      g.addColorStop(0.45, `rgba(193,138,74,${0.08*globalIntensity + b*0.6})`);
      g.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,W,H);

      // 生成基礎粒子
      spawnBase();

      // 粒子更新 & 繪製
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.life -= 1;
        if(p.life <= 0){
          particles.splice(i,1);
          continue;
        }

        // 漂移
        const t = 1 - p.life/p.maxLife;
        // 向上飄並微微收束向中心
        const cx = W*0.5;
        p.vx += (cx - p.x) * (W*0.00000010);
        p.x += p.vx;
        p.y += p.vy;
        // 越往上越慢、越散
        p.vy *= 0.995;
        p.vx *= 0.996;

        // 粒子透明度：像被照亮再消失
        const a = (1 - t) * 0.26 * globalIntensity + boost*0.04;
        const size = p.size * (1.0 + t*0.55);

        // 顏色（燭光/餘燼）
        ctx.beginPath();
        ctx.fillStyle = `hsla(${p.hue}, 82%, ${56 + t*10}%, ${Math.max(0, a)})`;
        ctx.arc(p.x, p.y, size, 0, Math.PI*2);
        ctx.fill();
      }

      // 限制粒子數（性能）
      const cap = 520;
      if(particles.length > cap) particles.splice(0, particles.length-cap);

      requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);

    // 投入光點動畫（從表單位置飛入火焰）
    function castSparkFromElement(el){
      if(!el) return;
      const r = el.getBoundingClientRect();
      const c = canvas.getBoundingClientRect();
      const startX = (r.left + r.width*0.5 - c.left) * dpr;
      const startY = (r.top + r.height*0.5 - c.top) * dpr;

      const targetX = W*0.5;
      const targetY = H*0.80;

      const sparks = 32;
      for(let i=0;i<sparks;i++){
        const dx = (targetX - startX);
        const dy = (targetY - startY);
        const vx = dx * (0.008 + Math.random()*0.004) + (Math.random()*2-1)*W*0.0006;
        const vy = dy * (0.010 + Math.random()*0.004) - Math.random()*H*0.002;
        addParticle(startX, startY, vx, vy, 34 + Math.random()*18, (1.6+Math.random()*2.2)*dpr, 330 + Math.random()*20); // 帶粉光
      }

      // 亮一下再回穩
      boost = Math.min(1.2, boost + 0.85);
    }

    /* =========================
       Email Form (No Redirect)
       - 成功後 Toast + 火焰增亮 + 本機 count++
    ========================== */
    const toast = $('#toast');
    const iframe = $('#hidden_iframe');
    const emailInput = $('#email');
    const tendBtn = $('#tendBtn');
    let submittedAt = 0;

    function validEmail(v){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
    }

    $('#notify').addEventListener('submit', (e)=>{
      const email = (emailInput.value||'').trim();
      if(!validEmail(email)){
        e.preventDefault();
        alert('請輸入有效的 Email');
        return false;
      }
      submittedAt = Date.now();

      // 先做「投入爐火」的視覺回饋（即時）
      castSparkFromElement(tendBtn);

      // 本機 hearth count +1（示意）
      setCount(getCount()+1);
      applyLevel();

      return true;
    });

    iframe.addEventListener('load', ()=>{
      if(Date.now()-submittedAt < 350) return;
      emailInput.value = '';
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'), 2600);
    });

    /* =========================
       Reflection Quiz
       - 3 題選擇 -> 原型
       - 解鎖 kit（連結先用 #，你可替換）
    ========================== */
    const quiz = $('#quiz');
    const revealBtn = $('#revealResult');
    const resultBox = $('#result');
    const archetypeTitle = $('#archetypeTitle');
    const archetypeDesc = $('#archetypeDesc');

    const answers = {1:null,2:null,3:null};

    function selectOpt(qEl, optEl){
      const q = qEl.dataset.q;
      const v = optEl.dataset.v;
      answers[q] = v;
      $$('.opt', qEl).forEach(o=>o.classList.toggle('sel', o===optEl));
    }

    $$('.q', quiz).forEach(qEl=>{
      $$('.opt', qEl).forEach(opt=>{
        opt.addEventListener('click', ()=>selectOpt(qEl, opt));
      });
    });

    function computeArchetype(){
      // A/B/C 多數決（平衡時用 B 做中線）
      const vals = Object.values(answers).filter(Boolean);
      const c = {A:0,B:0,C:0};
      vals.forEach(v=>c[v]++);
      // 預設偏向 B（“中心與圓”）
      let pick = 'B';
      if(c.A > c.B && c.A > c.C) pick = 'A';
      else if(c.C > c.B && c.C > c.A) pick = 'C';
      else if(c.B >= c.A && c.B >= c.C) pick = 'B';

      // 定義原型
      if(pick === 'A'){
        return {
          title:'守火者 · Keeper of the Flame',
          desc:'你的力量來自穩定的節奏。你不追逐喧囂，而是讓每一天都能回到身體、回到呼吸，慢慢變得更強。',
          kit:{
            playlist:'#',
            wallpaper:'#',
            audio:'#'
          }
        };
      }
      if(pick === 'C'){
        return {
          title:'寧靜守護者 · Guardian of Silence',
          desc:'你擅長把聲音關小，把感受放大。你不靠外放的張揚證明自己，而是靠清晰的內在秩序走得很遠。',
          kit:{
            playlist:'#',
            wallpaper:'#',
            audio:'#'
          }
        };
      }
      return {
        title:'織夢者 · Weaver of Warmth',
        desc:'你把溫柔當成一種決心。你允許自己成為自己，並且在每一次選擇裡，收回主權，把火焰點在心裡。',
        kit:{
          playlist:'#',
          wallpaper:'#',
          audio:'#'
        }
      };
    }

    revealBtn.addEventListener('click', ()=>{
      // 必須 3 題都有選
      if(!answers[1] || !answers[2] || !answers[3]){
        toast.textContent = '先回答三個問題，再解鎖靜心包。';
        toast.classList.add('show');
        setTimeout(()=>toast.classList.remove('show'), 2200);
        toast.textContent = '已投入爐火。你的一點光，會留在這裡。';
        return;
      }
      const a = computeArchetype();
      archetypeTitle.textContent = a.title;
      archetypeDesc.textContent = a.desc;

      // 替換 kit 連結（你之後改成真 URL）
      $('#kitPlaylist').href = a.kit.playlist;
      $('#kitWallpaper').href = a.kit.wallpaper;
      $('#kitAudio').href = a.kit.audio;

      resultBox.classList.add('show');
      resultBox.scrollIntoView({behavior:'smooth', block:'nearest'});
    });

    /* =========================
       Performance / Visibility
    ========================== */
    document.addEventListener('visibilitychange', ()=>{
      running = !document.hidden;
      if(running) requestAnimationFrame(draw);
    });

    /* =========================
       Extra: stop canvas if motion OFF
    ========================== */
    function syncCanvasWithMotion(){
      const off = localStorage.getItem(MOTION_KEY) === '1';
      if(off){
        running = false;
        // 清乾淨，留“靜態餘燼”
        ctx.clearRect(0,0,W,H);
        const gx = W*0.5, gy = H*0.86;
        const g = ctx.createRadialGradient(gx,gy,0,gx,gy,H*0.42);
        g.addColorStop(0, 'rgba(230,118,144,.10)');
        g.addColorStop(0.45, 'rgba(193,138,74,.07)');
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);
      }else{
        running = true;
        requestAnimationFrame(draw);
      }
    }
    syncCanvasWithMotion();
    motionToggle.addEventListener('click', ()=>setTimeout(syncCanvasWithMotion, 20));

    /* 初始 */
    requestCheck();
    updateActiveDot();
  </script>
</body>
</html>
