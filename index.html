<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>HESTiA — Tone on Tone 首發色投票</title>
  <link rel="icon" href="favicon.png" type="image/png" sizes="32x32" />

  <!--
  HESTIA — Tone-on-Tone 首發色投票
  6 色 Tone-on-Tone 色票組（Background / Core / Highlight）
  （順序：紅 → 橙 → 綠 → 藍 → 紫 → 咖）

  - IGNITION（點燃紅）
    Background: hsl(8 32% 12%)  #281715
    Core:       hsl(8 92% 54%)  #F63B1E
    Highlight:  hsl(8 100% 68%)  #FF725C

  - MOMENTUM（動能橙）
    Background: hsl(28 34% 12%)  #291E14
    Core:       hsl(28 92% 54%)  #F6831E
    Highlight:  hsl(28 100% 68%)  #FFA85C

  - GROUND（著地綠）
    Background: hsl(132 28% 11%)  #142417
    Core:       hsl(132 78% 46%)  #1AD13E
    Highlight:  hsl(132 95% 64%)  #4CFA6F

  - AIRFLOW（氣流藍）
    Background: hsl(205 30% 12%)  #152028
    Core:       hsl(205 88% 54%)  #229BF1
    Highlight:  hsl(205 100% 68%)  #5CBBFF

  - PULSE（脈動紫）
    Background: hsl(275 30% 12%)  #201528
    Core:       hsl(275 86% 52%)  #961BEE
    Highlight:  hsl(275 100% 68%)  #BB5CFF

  - FORGE（鍛造咖）
    Background: hsl(28 18% 10%)  #1E1915
    Core:       hsl(28 66% 28%)  #774418
    Highlight:  hsl(28 92% 46%)  #E16E09

  ============================
  「每個 Email 只能投一次」建議後台（Apps Script Web App）
  ============================
  // Google Apps Script（建議做「每個 email 只能投一次」的後台機制）
  // 1) 建立 Google Sheet：欄位建議 A=timestamp, B=email, C=color
  // 2) Extensions → Apps Script，貼上本程式碼
  // 3) Deploy → New deployment → Web app
  //    - Execute as: Me
  //    - Who has access: Anyone
  // 4) 得到 Web App URL，填入 HTML 內 UNIQUE_CHECK_ENDPOINT / VOTE_ENDPOINT

  const SHEET_NAME = 'votes';

  function doPost(e) {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sh = ss.getSheetByName(SHEET_NAME) || ss.insertSheet(SHEET_NAME);

    const action = (e.parameter.action || '').toLowerCase();
    const email  = (e.parameter.email  || '').trim().toLowerCase();
    const color  = (e.parameter.color  || '').trim();

    if (!email) return _json({ ok:false, reason:'missing_email' });

    // 建立 email 索引（讀 B 欄）
    const lastRow = sh.getLastRow();
    const emails = lastRow >= 2 ? sh.getRange(2, 2, lastRow-1, 1).getValues().flat().map(x=>String(x||'').toLowerCase()) : [];

    const exists = emails.includes(email);

    if (action === 'check') {
      return _json({ ok:true, exists });
    }

    if (action === 'vote') {
      if (exists) return _json({ ok:false, reason:'already_voted' });

      sh.appendRow([new Date(), email, color]);
      return _json({ ok:true, saved:true });
    }

    return _json({ ok:false, reason:'unknown_action' });
  }

  function _json(obj){
    return ContentService.createTextOutput(JSON.stringify(obj))
      .setMimeType(ContentService.MimeType.JSON);
  }
  -->

  <style>
    :root {
      --hue: 8;
      --sat: 92%;
      --lum: 54%;

      --tone-bg: hsl(var(--hue) 30% 10%);
      --tone-atm: hsl(var(--hue) 34% 12%);
      --tone-core: hsl(var(--hue) var(--sat) var(--lum));
      --tone-hi: hsl(var(--hue) 100% 68%);

      --uiText: rgba(255,255,255,.92);
      --uiTextMuted: rgba(255,255,255,.72);
      --uiStroke: rgba(255,255,255,.14);

      --safeTop: env(safe-area-inset-top);
      --safeBottom: env(safe-area-inset-bottom);
      --safeLeft: env(safe-area-inset-left);
      --safeRight: env(safe-area-inset-right);

      --ease: cubic-bezier(.2,.8,.2,1);
      --ease2: cubic-bezier(.16,1,.3,1);
      --dur: 900ms;
    }

    *{ box-sizing:border-box; }
    html, body {
      height:100%;
      margin:0;
      background:#000;
      color:var(--uiText);
      font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", "SF Pro Text",
        "PingFang TC","Noto Sans TC","Microsoft JhengHei", sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
      overscroll-behavior-y:none;
    }

    body {
      -webkit-user-select:none; user-select:none;
      -webkit-touch-callout:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    input { user-select:text; -webkit-user-select:text; -webkit-touch-callout:default; }

    .app {
      min-height:100vh;
      position:relative;
      overflow:hidden;
      background:
        radial-gradient(1200px 900px at 18% 16%, color-mix(in oklab, var(--tone-core), white 12%) 0%, rgba(0,0,0,0) 56%),
        radial-gradient(900px 900px at 82% 28%, color-mix(in oklab, var(--tone-core), black 36%) 0%, rgba(0,0,0,0) 62%),
        linear-gradient(180deg, var(--tone-bg), var(--tone-atm) 42%, var(--tone-bg) 100%);
      transition: background 900ms var(--ease);
      transform: translateZ(0);
    }

    .app::before {
      content:"";
      position:absolute;
      inset:-20%;
      pointer-events:none;
      opacity:.14;
      mix-blend-mode: overlay;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.32'/%3E%3C/svg%3E");
    }

    .radar {
      position:absolute;
      inset:-55%;
      border-radius:999px;
      background:
        conic-gradient(from 0deg,
          rgba(255,255,255,.00) 0deg,
          color-mix(in oklab, var(--tone-core), white 22%) 55deg,
          rgba(255,255,255,.00) 120deg,
          color-mix(in oklab, var(--tone-core), white 16%) 215deg,
          rgba(255,255,255,.00) 360deg);
      opacity:.58;
      animation: radarSpin 3.2s linear infinite;
      pointer-events:none;
      mix-blend-mode: screen;
      filter: blur(0.6px);
    }
    .radar::after {
      content:"";
      position:absolute; inset:16%;
      border-radius:999px;
      background:
        radial-gradient(closest-side,
          color-mix(in oklab, var(--tone-core), white 24%) 0%,
          rgba(255,255,255,.06) 44%,
          rgba(0,0,0,.00) 72%);
      opacity:.74;
      filter: blur(16px);
    }
    @keyframes radarSpin{ to{ transform: rotate(360deg); } }

    .topbar {
      position:fixed;
      top: calc(10px + var(--safeTop));
      left: calc(12px + var(--safeLeft));
      right: calc(12px + var(--safeRight));
      display:flex;
      align-items:center;
      justify-content:space-between;
      z-index:60;
      pointer-events:none;
      opacity:.94;
    }
    .chip {
      pointer-events:auto;
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 12px 40px rgba(0,0,0,.38);
      color: var(--uiTextMuted);
      font-size:12px;
      letter-spacing:.08em;
      text-transform: uppercase;
      white-space:nowrap;
    }
    .chip b{ color:var(--uiText); font-weight:720; letter-spacing:.06em; }
    .chip .dot {
      width:10px; height:10px; border-radius:99px;
      background: var(--tone-core);
      box-shadow: 0 0 16px color-mix(in oklab, var(--tone-core), transparent 45%);
      border: 1px solid rgba(255,255,255,.14);
    }

    .fade-in {
      opacity:0;
      transform: translateY(14px);
      animation: fadeInUp var(--dur) var(--ease2) forwards;
    }
    .fade-in.delay-1{ animation-delay: 120ms; }
    .fade-in.delay-2{ animation-delay: 220ms; }
    .fade-in.delay-3{ animation-delay: 340ms; }
    @keyframes fadeInUp{ to{ opacity:1; transform: translateY(0); } }

    .stage {
      position:relative;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(18px + var(--safeTop)) calc(18px + var(--safeRight)) calc(18px + var(--safeBottom)) calc(18px + var(--safeLeft));
      z-index:10;
    }
    .monolith { width: min(520px, 92vw); text-align:center; }

    .mark-wrap {
      margin: 0 auto;
      width: min(280px, 62vw);
      max-width: 280px;
      aspect-ratio: 1/1;
      border-radius: 999px;
      background:
        radial-gradient(closest-side at 35% 30%,
          color-mix(in oklab, var(--tone-core), white 24%) 0%,
          color-mix(in oklab, var(--tone-core), transparent 42%) 50%,
          transparent 72%),
        radial-gradient(closest-side at 65% 68%,
          color-mix(in oklab, var(--tone-core), black 35%) 0%,
          transparent 64%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.22));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 56px rgba(0,0,0,.55);
      overflow:hidden;
      transform: translateZ(0);
      position:relative;
    }
    .mark {
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2;
    }
    .mark svg{ width:46%; height:46%; filter: drop-shadow(0 12px 40px rgba(0,0,0,.55)); opacity:.95; }

    .tagline {
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size:12px;
      color: var(--uiTextMuted);
      margin-top: 18px;
    }
    .date {
      margin-top: 10px;
      font-size: 14px;
      color: var(--uiTextMuted);
      opacity:.9;
      line-height: 1.7;
    }
    .hint {
      margin-top: 14px;
      font-size: 14px;
      color: var(--uiTextMuted);
      line-height:1.7;
    }

    .gate {
      margin: 18px auto 0;
      width: min(520px, 92vw);
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:center;
      flex-wrap: wrap;
    }
    .gate input {
      flex: 1 1 240px;
      min-width: 0;
      height: 46px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--uiText);
      padding: 0 12px;
      font-size: 14px;
      outline: none;
    }
    .gate input::placeholder{ color: rgba(255,255,255,.42); }
    .gate button {
      flex: 0 0 auto;
      height: 46px;
      padding: 0 16px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: color-mix(in oklab, var(--tone-core), rgba(255,255,255,.08) 18%);
      color: var(--uiText);
      font-weight: 780;
      cursor:pointer;
      transition: transform 180ms var(--ease), opacity 220ms var(--ease);
      white-space: nowrap;
    }
    .gate button:disabled{ opacity:.55; cursor:not-allowed; }
    .gate button:active{ transform: scale(.985); }
    .gate .warn {
      width:100%;
      margin-top: 8px;
      font-size: 12px;
      color: rgba(255,255,255,.72);
      opacity: .0;
      transform: translateY(-4px);
      transition: opacity 220ms var(--ease), transform 220ms var(--ease);
    }
    .gate .warn.on{ opacity:1; transform: translateY(0); }

    .spectrum {
      position:absolute;
      inset:0;
      overflow-y:auto;
      scroll-snap-type: y mandatory;
      -webkit-overflow-scrolling: touch;
      z-index:8;
      opacity:0;
      pointer-events:none;
      transform: translateY(10px);
      transition: opacity 520ms var(--ease), transform 640ms var(--ease);
      will-change: transform, opacity;
    }
    .spectrum.is-open {
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    .stall {
      min-height: 100vh;
      scroll-snap-align: start;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:
        calc(18px + var(--safeTop))
        calc(18px + var(--safeRight))
        calc(40px + var(--safeBottom))
        calc(18px + var(--safeLeft));
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
      contain: paint;
    }
    .stall::before {
      content:"";
      position:absolute;
      inset:-18%;
      opacity:.55;
      pointer-events:none;
      transform: translateZ(0);
    }

    /* Motifs (same as v3) */
    .stall[data-motif="magma"]::before {
      background:
        radial-gradient(900px 520px at 28% 22%, color-mix(in oklab, var(--tone-core), white 14%) 0%, transparent 55%),
        radial-gradient(900px 620px at 72% 78%, color-mix(in oklab, var(--tone-core), black 35%) 0%, transparent 60%),
        repeating-linear-gradient(110deg, color-mix(in oklab, var(--tone-core), transparent 82%) 0 18px, transparent 18px 40px);
      animation: driftA 6.0s var(--ease) infinite alternate;
    }
    .stall[data-motif="spark"]::before {
      background:
        radial-gradient(820px 560px at 35% 25%, color-mix(in oklab, var(--tone-core), white 18%) 0%, transparent 62%),
        radial-gradient(980px 720px at 70% 75%, color-mix(in oklab, var(--tone-core), black 34%) 0%, transparent 66%),
        repeating-linear-gradient(135deg, color-mix(in oklab, var(--tone-core), transparent 84%) 0 10px, transparent 10px 30px);
      animation: driftB 6.8s var(--ease) infinite alternate;
    }
    .stall[data-motif="mist"]::before {
      background:
        radial-gradient(700px 520px at 45% 30%, color-mix(in oklab, var(--tone-core), white 22%) 0%, transparent 62%),
        radial-gradient(900px 620px at 60% 65%, color-mix(in oklab, var(--tone-core), transparent 40%) 0%, transparent 70%),
        radial-gradient(240px 240px at 20% 70%, rgba(255,255,255,.12) 0%, transparent 70%),
        radial-gradient(260px 260px at 80% 35%, rgba(255,255,255,.10) 0%, transparent 70%);
      animation: driftC 7.8s var(--ease) infinite alternate;
    }
    .stall[data-motif="moss"]::before {
      background:
        radial-gradient(820px 620px at 30% 35%, color-mix(in oklab, var(--tone-core), white 12%) 0%, transparent 60%),
        radial-gradient(940px 760px at 70% 70%, color-mix(in oklab, var(--tone-core), black 40%) 0%, transparent 65%),
        repeating-radial-gradient(circle at 30% 40%, color-mix(in oklab, var(--tone-core), transparent 74%) 0 6px, transparent 6px 16px);
      animation: driftD 8.8s var(--ease) infinite alternate;
    }
    .stall[data-motif="nebula"]::before {
      background:
        radial-gradient(760px 560px at 35% 28%, color-mix(in oklab, var(--tone-core), white 18%) 0%, transparent 62%),
        radial-gradient(980px 780px at 72% 70%, color-mix(in oklab, var(--tone-core), black 38%) 0%, transparent 68%),
        radial-gradient(220px 220px at 25% 75%, rgba(255,255,255,.10) 0%, transparent 70%),
        radial-gradient(180px 180px at 78% 35%, rgba(255,255,255,.08) 0%, transparent 70%);
      animation: driftC 8.2s var(--ease) infinite alternate;
    }
    .stall[data-motif="forge"]::before {
      background:
        radial-gradient(820px 620px at 28% 20%, color-mix(in oklab, var(--tone-core), white 14%) 0%, transparent 60%),
        radial-gradient(980px 760px at 76% 80%, color-mix(in oklab, var(--tone-core), black 44%) 0%, transparent 68%),
        repeating-linear-gradient(90deg, color-mix(in oklab, var(--tone-core), transparent 86%) 0 2px, transparent 2px 10px);
      animation: driftB 7.2s var(--ease) infinite alternate;
    }
    @keyframes driftA { from{ transform: translate3d(-1.2%,-1.0%,0) scale(1.02); opacity:.48; } to{ transform: translate3d( 1.0%, 1.4%,0) scale(1.05); opacity:.60; } }
    @keyframes driftB { from{ transform: translate3d(-1.0%, .7%,0) scale(1.02); opacity:.46; } to{ transform: translate3d( 1.0%,-.9%,0) scale(1.06); opacity:.60; } }
    @keyframes driftC { from{ transform: translate3d(-1.0%, .6%,0) scale(1.02); opacity:.50; } to{ transform: translate3d( 1.0%,-.7%,0) scale(1.06); opacity:.62; } }
    @keyframes driftD { from{ transform: translate3d(.7%, .4%,0) scale(1.02); opacity:.46; } to{ transform: translate3d(-.7%,-.6%,0) scale(1.06); opacity:.60; } }

    .product { width: min(520px, 92vw); text-align:center; position:relative; z-index:2; }
    .opt { display:flex; align-items:center; justify-content:center; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
    .opt-en {
      font-size:12px; letter-spacing:.14em; text-transform: uppercase;
      color: var(--uiTextMuted);
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .opt-zh { font-size:12px; color: var(--uiTextMuted); opacity:.92; }

    .colorName { margin:0 0 14px; line-height:1.05; }
    .colorName .en { display:block; font-size: clamp(34px, 8vw, 54px); font-weight:820; letter-spacing:-.02em; }
    .colorName .zh { display:block; margin-top:8px; font-size:14px; letter-spacing:.14em; color: var(--uiTextMuted); }

    .chargeSquare {
      margin: 0 auto;
      width: min(320px, 72vw);
      max-width: 320px;
      aspect-ratio: 1/1;
      border-radius: 22px;
      border: 1px solid var(--uiStroke);
      background:
        radial-gradient(closest-side at 30% 25%, color-mix(in oklab, var(--tone-core), white 26%) 0%, transparent 58%),
        radial-gradient(closest-side at 70% 80%, color-mix(in oklab, var(--tone-core), black 30%) 0%, transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.22));
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
      cursor:pointer;
      touch-action: manipulation;
    }
    .chargeSquare:active{ transform: scale(.992); }

    .sqBoost {
      position:absolute; inset:-30%;
      background:
        radial-gradient(closest-side,
          color-mix(in oklab, var(--tone-core), white 18%) 0%,
          transparent 62%);
      opacity:0;
      filter: blur(22px);
      mix-blend-mode: screen;
      pointer-events:none;
      transform: scale(.9);
    }

    .sqAura {
      position:absolute; inset:-10%;
      background:
        radial-gradient(260px 260px at var(--gx,50%) var(--gy,50%),
          color-mix(in oklab, var(--tone-core), white 28%) 0%,
          transparent 70%);
      opacity: .0;
      transition: opacity 160ms var(--ease);
      mix-blend-mode: screen;
      pointer-events:none;
      filter: blur(10px);
    }
    .sqRipple {
      position:absolute; inset:-20%;
      background:
        radial-gradient(circle at 50% 50%,
          rgba(255,255,255,.0) 0%,
          rgba(255,255,255,.10) 22%,
          rgba(255,255,255,.0) 48%);
      opacity:0;
      transform: scale(.85);
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .sqParticles {
      position:absolute; inset:0;
      pointer-events:none;
      opacity:0;
      background:
        radial-gradient(2px 2px at 20% 35%, rgba(255,255,255,.22) 0 60%, transparent 62%),
        radial-gradient(2px 2px at 68% 22%, rgba(255,255,255,.18) 0 60%, transparent 62%),
        radial-gradient(2px 2px at 72% 70%, rgba(255,255,255,.18) 0 60%, transparent 62%),
        radial-gradient(2px 2px at 35% 78%, rgba(255,255,255,.22) 0 60%, transparent 62%);
      filter: blur(.3px);
    }

    .chargeSquare.is-holding .sqAura{ opacity:.95; }
    .chargeSquare.is-holding .sqBoost{ opacity:.75; animation: boost 420ms var(--ease) infinite alternate; }
    @keyframes boost{ to{ transform: scale(1.05); opacity:.92; } }

    .chargeSquare.is-holding .sqParticles{ opacity:.9; animation: twinkle 420ms linear infinite; }
    @keyframes twinkle{ 50%{ opacity:.55; } }

    .chargeSquare.is-holding .sqRipple {
      opacity:.85;
      animation: ripple 620ms var(--ease) infinite;
    }
    @keyframes ripple {
      from{ transform: scale(.82); opacity:.0; }
      35%{ opacity:.65; }
      to{ transform: scale(1.18); opacity:.0; }
    }

    .sqInner { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
    .markSvg {
      width: 44%;
      height: 44%;
      filter: drop-shadow(0 14px 45px rgba(0,0,0,.55));
      opacity:.96;
    }
    .markStroke1, .markStroke2 {
      stroke: rgba(255,255,255,.92);
      stroke-width: 3.2;
      fill: none;
      vector-effect: non-scaling-stroke;
    }
    .markStroke2{ stroke-width: 2.6; opacity:.82; }

    .ring {
      position:absolute;
      inset: 10px;
      width: calc(100% - 20px);
      height: calc(100% - 20px);
      pointer-events:none;
      opacity: .0;
      transform: rotate(-90deg);
      transition: opacity 160ms var(--ease);
    }
    .chargeSquare.is-holding .ring{ opacity: .95; }
    .ringTrack {
      fill:none;
      stroke: rgba(255,255,255,.10);
      stroke-width: 3;
    }
    .ringProg {
      fill:none;
      stroke: color-mix(in oklab, var(--tone-core), white 16%);
      stroke-width: 4;
      stroke-linecap: round;
      stroke-dasharray: 276.46;
      stroke-dashoffset: 276.46;
      filter: drop-shadow(0 0 18px color-mix(in oklab, var(--tone-core), transparent 60%));
    }

    .sqProgress {
      position:absolute; left:12px; right:12px; bottom:12px;
      height: 10px; border-radius:999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      overflow:hidden;
      pointer-events:none;
    }
    .sqFill {
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, color-mix(in oklab, var(--tone-core), white 18%), color-mix(in oklab, var(--tone-core), white 0%));
      box-shadow: 0 0 30px color-mix(in oklab, var(--tone-core), transparent 55%);
      transition: width 60ms linear;
    }

    .hintLine { margin-top: 14px; font-size: 13px; color: var(--uiTextMuted); }

    .bloom {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(600px 600px at 50% 52%,
          color-mix(in oklab, var(--tone-core), white 18%) 0%,
          color-mix(in oklab, var(--tone-core), transparent 35%) 45%,
          transparent 72%),
        radial-gradient(1200px 1200px at 50% 52%,
          color-mix(in oklab, var(--tone-core), white 8%) 0%,
          transparent 60%);
      opacity: 0;
      pointer-events:none;
      z-index: 120;
      transform: scale(1.05);
      transition: opacity 420ms var(--ease), transform 620ms var(--ease);
    }
    .bloom.is-on{ opacity:1; transform: scale(1); }

    .confirm {
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: calc(18px + var(--safeTop)) calc(18px + var(--safeRight)) calc(18px + var(--safeBottom)) calc(18px + var(--safeLeft));
      z-index: 130;
      opacity:0;
      pointer-events:none;
      transform: translateY(10px);
      transition: opacity 420ms var(--ease), transform 620ms var(--ease);
    }
    .confirm.is-on{ opacity:1; pointer-events:auto; transform: translateY(0); }

    .panel {
      width: min(560px, 92vw);
      border-radius: 26px;
      border: 1px solid var(--uiStroke);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.30));
      box-shadow: 0 22px 65px rgba(0,0,0,.65);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      overflow:hidden;
      position:relative;
    }
    .panel::before {
      content:"";
      position:absolute; inset:-20%;
      background:
        radial-gradient(600px 400px at 30% 20%, color-mix(in oklab, var(--tone-core), white 18%) 0%, transparent 62%),
        radial-gradient(700px 460px at 75% 75%, color-mix(in oklab, var(--tone-core), black 25%) 0%, transparent 68%);
      opacity:.65;
      pointer-events:none;
    }
    .content{ position:relative; padding: 18px 18px 16px; }
    .content h2{ margin:0 0 6px; font-size: 20px; letter-spacing:-.01em; }
    .content .subEn{ margin:0 0 10px; font-size: 12px; letter-spacing:.12em; text-transform: uppercase; color: var(--uiTextMuted); }
    .content p{ margin:0 0 12px; font-size: 14px; line-height:1.7; color: var(--uiTextMuted); }

    /* 卡片移到上面 + 放大（你要的） */
    .cardPreview {
      width: 100%;
      aspect-ratio: 16/10;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
      background: rgba(0,0,0,.18);
      margin: 4px 0 12px;
      transform: scale(1.06);
      transform-origin: top center;
    }
    .cardPreview canvas{ width:100%; height:100%; display:block; }

    .actions{ display:flex; gap:10px; align-items:stretch; flex-wrap: wrap; margin: 12px 0 10px; }
    .btn {
      appearance:none;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      color: var(--uiText);
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 760;
      cursor:pointer;
      flex: 1 1 180px;
      transition: transform 180ms var(--ease), background 220ms var(--ease);
      white-space: nowrap;
    }
    .btn:active{ transform: scale(.985); }
    .btn.primary {
      background: color-mix(in oklab, var(--tone-core), rgba(255,255,255,.08) 18%);
      border-color: color-mix(in oklab, var(--tone-core), rgba(255,255,255,.18) 35%);
    }

    .heat {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 6px;
    }
    .cell {
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      padding: 10px 10px;
      position:relative;
      overflow:hidden;
    }
    .cell .name{ font-size: 12px; letter-spacing:.08em; text-transform: uppercase; color: var(--uiTextMuted); margin:0 0 6px; }
    .bar{ height: 10px; border-radius: 999px; background: rgba(255,255,255,.08); overflow:hidden; border: 1px solid rgba(255,255,255,.10); }
    .bar > i{ display:block; height:100%; width: 10%; border-radius: 999px; background: linear-gradient(90deg, rgba(255,255,255,.12), rgba(255,255,255,.34)); box-shadow: 0 0 22px rgba(255,255,255,.16); }
    .pct{ margin-top: 8px; font-size: 12px; color: var(--uiTextMuted); }

    .tiny{ font-size: 12px; color: var(--uiTextMuted); margin-top: 10px; line-height:1.6; }

    .toast {
      position: fixed;
      left: 50%;
      top: calc(56px + var(--safeTop));
      transform: translateX(-50%);
      z-index: 200;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 14px 45px rgba(0,0,0,.45);
      color: var(--uiText);
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: opacity 240ms var(--ease), transform 240ms var(--ease);
    }
    .toast.on{ opacity:1; transform: translateX(-50%) translateY(0); }

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
    }
  
    /* ===== Requested Patch (minimal) ===== */

    /* 1) Hero HLOGO 縮小 */
    .heroMarkImg{
      width: min(120px, 32vw) !important;
      height:auto;
      display:block;
      margin: 0 auto;
      user-select:none;
      -webkit-user-drag:none;
    }

    /* 2) Hero 圓盤雷達移除（保留背景換色） */
    #monolithStage .mark-wrap .radar{ display:none !important; }

    /* 3) 全頁文字固定白色 */
    :root{
      --uiText: rgba(255,255,255,.92) !important;
      --uiSub: rgba(255,255,255,.70) !important;
      --uiHair: rgba(255,255,255,.22) !important;
    }
    body, body *{ color: var(--uiText); }
    .chip, .chip *{ color: rgba(255,255,255,.88) !important; }
    input, input::placeholder{ color: rgba(255,255,255,.88) !important; }

    /* 4) VOTE A–F：移除紋理，只留純色 */
    .stall::before, .stall::after,
    .stall .grain, .stall .noise, .stall .texture, .stall .matte, .stall .bgTexture,
    .stall .bg, .stall .bgLayer, .stall .bgNoise, .stall .bgGrain{
      content:none !important;
      display:none !important;
    }
    .stall{ background: var(--tone-core) !important; }

    /* 5) Flamemark 縮小（你說太大） */
    .flame-img{
      width: 22% !important; /* 約縮半 */
      height:auto;
      display:block;
      opacity:.92;
      filter: drop-shadow(0 10px 40px rgba(0,0,0,.55));
      user-select:none;
      -webkit-user-drag:none;
    }

    /* 7) 按壓注入：移除圓圈，只留長條；加粗 2 倍＋光澤 */
    .ring{ display:none !important; }
    .sqProgress{
      height: 18px !important; /* 加粗一倍（原本約 9px） */
      border-radius: 999px !important;
      overflow:hidden;
      background: rgba(255,255,255,.16) !important;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.12);
    }
    .sqFill{
      background: linear-gradient(90deg,
        color-mix(in oklab, var(--tone-core), white 24%),
        color-mix(in oklab, var(--tone-core), white 8%)
      ) !important;
      box-shadow:
        0 0 22px color-mix(in oklab, var(--tone-core), transparent 45%),
        inset 0 1px 0 rgba(255,255,255,.28),
        inset 0 -1px 0 rgba(0,0,0,.22);
    }

    /* Wordmark 縮小 50% */
    .heroWordmark img{ width: min(180px, 40vw) !important; height:auto; display:block; margin: 14px auto 0; }

    /* 4) Tone on tone 粗體略放大 */
    .date{ font-weight: 800 !important; font-size: 18px !important; letter-spacing: .06em; }

    /* 8) 結果頁落款置中 */
    .resultFooter{
      margin-top: 18px;
      text-align:center;
      font-weight: 400;
      letter-spacing: .18em;
      font-size: 12px;
      opacity: .85;
    }
    .resultFooter .reg{
      font-size: 11px;
      vertical-align: super;
      margin-left: 2px;
      opacity:.9;
    }


    /* === Patch: Vote flamemark 置中 + 70% 佔比（A–F）=== */
    .chargeSquare .flameMark{
      position:absolute !important;
      inset:0 !important;
      display:grid !important;
      place-items:center !important;
      pointer-events:none;
    }
    .chargeSquare .flame-img{
      width: 70% !important;
      height:auto !important;
      max-width: 70% !important;
      max-height: 70% !important;
      display:block !important;
      margin: 0 auto !important;
      opacity:.92;
    }

    /* === Patch: 充能條更明顯（更亮、更粗、更有光澤）=== */
    .sqProgress{
      height: 20px !important;
      background: rgba(0,0,0,.20) !important;
      border: 1px solid rgba(255,255,255,.18) !important;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.08),
        0 10px 26px rgba(0,0,0,.28) !important;
    }
    .sqFill{
      position:relative;
      background: linear-gradient(90deg,
        color-mix(in oklab, var(--tone-core), white 40%),
        color-mix(in oklab, var(--tone-core), white 10%)
      ) !important;
      box-shadow:
        0 0 30px color-mix(in oklab, var(--tone-core), transparent 35%),
        0 0 14px rgba(255,255,255,.16),
        inset 0 1px 0 rgba(255,255,255,.38),
        inset 0 -1px 0 rgba(0,0,0,.18) !important;
    }
    .sqFill::after{
      content:"";
      position:absolute; inset:-30% -20%;
      background: linear-gradient(115deg,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,.38) 45%,
        rgba(255,255,255,0) 60%);
      transform: translateX(-60%);
      opacity: .55;
      filter: blur(0.4px);
      animation: barShimmer 1.2s linear infinite;
      pointer-events:none;
    }
    @keyframes barShimmer{
      from{ transform: translateX(-60%); }
      to{ transform: translateX(60%); }
    }

    /* === Patch: 結果頁按鈕移除（防守式）=== */
    .resultActions{ display:none !important; }

    /* === Patch: 結果卡右側 Logo（HLOGO）=== */
    .resultHlogo{
      width: 110px;
      height:auto;
      display:block;
      opacity:.92;
      filter: drop-shadow(0 14px 55px rgba(0,0,0,.45));
      user-select:none;
      -webkit-user-drag:none;
    }

    /* === Patch: 結果頁落款置中 === */
    .resultFooter{
      margin-top: 18px;
      text-align:center;
      font-weight: 700;
      letter-spacing: .18em;
      font-size: 12px;
      opacity: .85;
    }
    .resultFooter .reg{
      font-size: 11px;
      vertical-align: super;
      margin-left: 2px;
      opacity:.9;
    }


    /* iOS Safari: prevent input focus zoom */
    input, select, textarea{ font-size:16px !important; -webkit-text-size-adjust:100%; }

    /* Guide page (between Gate and Vote) */
    
    /* Vote guide page (part of Spectrum) */
    .stall--guide{
      background: var(--tone-core);
    }
    .stall--guide .guideInner{
      height: 100%;
      width: 100%;
      display: grid;
      place-items: center;
      text-align: center;
      padding: 26px;
      font-size: 15px;
      line-height: 1.6;
      letter-spacing: .02em;
      opacity: .95;
    }
</style>
</head>

<body>
  <div class="app" id="app">

    <div class="topbar">
      <div class="chip"><span class="dot"></span><b>HESTIA</b> <span id="phase">PRISM</span></div>
      <div class="chip" id="activeColorChip" style="opacity:.0; transform: translateY(-6px); transition: opacity 420ms var(--ease), transform 420ms var(--ease);">
        <span style="opacity:.9">Color</span> <b id="activeColorName">—</b>
      </div>
    </div>

    <section class="stage" id="monolithStage" aria-label="The Monolith">
      <div class="monolith">
        <div class="mark-wrap fade-in" id="enterPrism" aria-label="Prism mark">
          <div class="radar" aria-hidden="true"></div>
          <div class="mark" aria-hidden="true">
            <img class="heroMarkImg" src="HLOGO.png" alt="HESTIA Logo">
          </div>
        </div>

        <div class="heroWordmark fade-in delay-1"><img src="wordmark.png" alt="HESTIA Wordmark"></div>
        <div class="date fade-in delay-2">首發色投票．TONE  ON TONE</div>
        <div class="hint fade-in delay-3">請先輸入 Email 以進行投票<br>最高得票色彩世界投票者，將獲得首波發售折扣碼</div>

        <div class="gate fade-in delay-3" aria-label="Email gate">
          <input id="gateEmail" type="email" inputmode="email" autocomplete="email" placeholder="輸入你的 Email（必填）" aria-label="輸入你的 Email（必填）"/>
          <button id="gateBtn" type="button">進入投票</button>
          <div class="warn" id="gateWarn">請先輸入有效 Email 才能進入投票。</div>
        </div>
      </div>
    </section>

    <main class="spectrum" id="spectrum" aria-label="The Spectrum">

      <section class="stall stall--guide" data-world="guide" aria-label="投票導覽">
        <div class="guideInner">
          本投票只針對顏色色相<br>
          深淺明度、飽和彩度皆不考慮<br>
          黑白灰等無彩色不列入投票選項<br>
          接下來每頁代表將一個色相<br>
          下滑立即開始！
        </div>
      </section>

<section class="stall" data-key="ignition" data-en="IGNITION" data-zh="點燃紅"
        data-hue="8" data-sat="92" data-lum="54" data-motif="magma" aria-label="IGNITION">
        <div class="product">
          <div class="opt">
            <span class="opt-en">Option A</span>
            <span class="opt-zh">爆發 / 進場即存在</span>
          </div>

          <h1 class="colorName">
            <span class="en">IGNITION</span>
            <span class="zh">點燃紅</span>
          </h1>

          <div class="chargeSquare" data-charge-square role="button" tabindex="0" aria-label="長按一秒投票">
            <div class="sqAura" aria-hidden="true"></div>
            <div class="sqRipple" aria-hidden="true"></div>
            <div class="sqParticles" aria-hidden="true"></div>

            <div class="sqInner" aria-hidden="true">
              <div class="flameMark" aria-hidden="true">
                <img class="flame-img" src="Flamemark.png" alt="Flame Mark" onerror="this.onerror=null;this.src='flamemark.png';">
              </div>
            </div>

            <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
              <circle class="ringTrack" cx="60" cy="60" r="44"/>
              <circle class="ringProg" cx="60" cy="60" r="44"/>
            </svg>

            <div class="sqProgress" aria-hidden="true">
              <div class="sqFill" data-sq-fill></div>
            </div>

            <div class="sqBoost" aria-hidden="true"></div>
          </div>

          <div class="hintLine" aria-hidden="true">長按一秒，注滿能量後完成</div>
        </div>
      </section>

      <section class="stall" data-key="momentum" data-en="MOMENTUM" data-zh="動能橙"
        data-hue="28" data-sat="92" data-lum="54" data-motif="spark" aria-label="MOMENTUM">
        <div class="product">
          <div class="opt">
            <span class="opt-en">Option B</span>
            <span class="opt-zh">推進 / 節奏輸出</span>
          </div>

          <h1 class="colorName">
            <span class="en">MOMENTUM</span>
            <span class="zh">動能橙</span>
          </h1>

          <div class="chargeSquare" data-charge-square role="button" tabindex="0" aria-label="長按一秒投票">
            <div class="sqAura" aria-hidden="true"></div>
            <div class="sqRipple" aria-hidden="true"></div>
            <div class="sqParticles" aria-hidden="true"></div>

            <div class="sqInner" aria-hidden="true">
              <div class="flameMark" aria-hidden="true">
                <img class="flame-img" src="Flamemark.png" alt="Flame Mark" onerror="this.onerror=null;this.src='flamemark.png';">
              </div>
            </div>

            <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
              <circle class="ringTrack" cx="60" cy="60" r="44"/>
              <circle class="ringProg" cx="60" cy="60" r="44"/>
            </svg>

            <div class="sqProgress" aria-hidden="true">
              <div class="sqFill" data-sq-fill></div>
            </div>

            <div class="sqBoost" aria-hidden="true"></div>
          </div>

          <div class="hintLine" aria-hidden="true">長按一秒，注滿能量後完成</div>
        </div>
      </section>

      <section class="stall" data-key="ground" data-en="GROUND" data-zh="著地綠"
        data-hue="132" data-sat="78" data-lum="46" data-motif="moss" aria-label="GROUND">
        <div class="product">
          <div class="opt">
            <span class="opt-en">Option C</span>
            <span class="opt-zh">穩定 / 長期累積</span>
          </div>

          <h1 class="colorName">
            <span class="en">GROUND</span>
            <span class="zh">著地綠</span>
          </h1>

          <div class="chargeSquare" data-charge-square role="button" tabindex="0" aria-label="長按一秒投票">
            <div class="sqAura" aria-hidden="true"></div>
            <div class="sqRipple" aria-hidden="true"></div>
            <div class="sqParticles" aria-hidden="true"></div>

            <div class="sqInner" aria-hidden="true">
              <div class="flameMark" aria-hidden="true">
                <img class="flame-img" src="Flamemark.png" alt="Flame Mark" onerror="this.onerror=null;this.src='flamemark.png';">
              </div>
            </div>

            <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
              <circle class="ringTrack" cx="60" cy="60" r="44"/>
              <circle class="ringProg" cx="60" cy="60" r="44"/>
            </svg>

            <div class="sqProgress" aria-hidden="true">
              <div class="sqFill" data-sq-fill></div>
            </div>

            <div class="sqBoost" aria-hidden="true"></div>
          </div>

          <div class="hintLine" aria-hidden="true">長按一秒，注滿能量後完成</div>
        </div>
      </section>

      <section class="stall" data-key="airflow" data-en="AIRFLOW" data-zh="氣流藍"
        data-hue="205" data-sat="88" data-lum="54" data-motif="mist" aria-label="AIRFLOW">
        <div class="product">
          <div class="opt">
            <span class="opt-en">Option D</span>
            <span class="opt-zh">呼吸 / 控制感</span>
          </div>

          <h1 class="colorName">
            <span class="en">AIRFLOW</span>
            <span class="zh">氣流藍</span>
          </h1>

          <div class="chargeSquare" data-charge-square role="button" tabindex="0" aria-label="長按一秒投票">
            <div class="sqAura" aria-hidden="true"></div>
            <div class="sqRipple" aria-hidden="true"></div>
            <div class="sqParticles" aria-hidden="true"></div>

            <div class="sqInner" aria-hidden="true">
              <div class="flameMark" aria-hidden="true">
                <img class="flame-img" src="Flamemark.png" alt="Flame Mark" onerror="this.onerror=null;this.src='flamemark.png';">
              </div>
            </div>

            <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
              <circle class="ringTrack" cx="60" cy="60" r="44"/>
              <circle class="ringProg" cx="60" cy="60" r="44"/>
            </svg>

            <div class="sqProgress" aria-hidden="true">
              <div class="sqFill" data-sq-fill></div>
            </div>

            <div class="sqBoost" aria-hidden="true"></div>
          </div>

          <div class="hintLine" aria-hidden="true">長按一秒，注滿能量後完成</div>
        </div>
      </section>

      <section class="stall" data-key="pulse" data-en="PULSE" data-zh="脈動紫"
        data-hue="275" data-sat="86" data-lum="52" data-motif="nebula" aria-label="PULSE">
        <div class="product">
          <div class="opt">
            <span class="opt-en">Option E</span>
            <span class="opt-zh">張力 / 個人風格</span>
          </div>

          <h1 class="colorName">
            <span class="en">PULSE</span>
            <span class="zh">脈動紫</span>
          </h1>

          <div class="chargeSquare" data-charge-square role="button" tabindex="0" aria-label="長按一秒投票">
            <div class="sqAura" aria-hidden="true"></div>
            <div class="sqRipple" aria-hidden="true"></div>
            <div class="sqParticles" aria-hidden="true"></div>

            <div class="sqInner" aria-hidden="true">
              <div class="flameMark" aria-hidden="true">
                <img class="flame-img" src="Flamemark.png" alt="Flame Mark" onerror="this.onerror=null;this.src='flamemark.png';">
              </div>
            </div>

            <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
              <circle class="ringTrack" cx="60" cy="60" r="44"/>
              <circle class="ringProg" cx="60" cy="60" r="44"/>
            </svg>

            <div class="sqProgress" aria-hidden="true">
              <div class="sqFill" data-sq-fill></div>
            </div>

            <div class="sqBoost" aria-hidden="true"></div>
          </div>

          <div class="hintLine" aria-hidden="true">長按一秒，注滿能量後完成</div>
        </div>
      </section>

      <section class="stall" data-key="forge" data-en="FORGE" data-zh="鍛造咖"
        data-hue="28" data-sat="66" data-lum="28" data-motif="forge" aria-label="FORGE">
        <div class="product">
          <div class="opt">
            <span class="opt-en">Option F</span>
            <span class="opt-zh">厚度 / 淬鍊時間感</span>
          </div>

          <h1 class="colorName">
            <span class="en">FORGE</span>
            <span class="zh">鍛造咖</span>
          </h1>

          <div class="chargeSquare" data-charge-square role="button" tabindex="0" aria-label="長按一秒投票">
            <div class="sqAura" aria-hidden="true"></div>
            <div class="sqRipple" aria-hidden="true"></div>
            <div class="sqParticles" aria-hidden="true"></div>

            <div class="sqInner" aria-hidden="true">
              <div class="flameMark" aria-hidden="true">
                <img class="flame-img" src="Flamemark.png" alt="Flame Mark" onerror="this.onerror=null;this.src='flamemark.png';">
              </div>
            </div>

            <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
              <circle class="ringTrack" cx="60" cy="60" r="44"/>
              <circle class="ringProg" cx="60" cy="60" r="44"/>
            </svg>

            <div class="sqProgress" aria-hidden="true">
              <div class="sqFill" data-sq-fill></div>
            </div>

            <div class="sqBoost" aria-hidden="true"></div>
          </div>

          <div class="hintLine" aria-hidden="true">長按一秒，注滿能量後完成</div>
        
        </div>
      </section>
    </main>

    <div class="bloom" id="bloom" aria-hidden="true"></div>

    <section class="confirm" id="confirm" aria-label="投票完成">
      <div class="panel">
        <div class="content">
          <h2 id="confirmTitle">投票完成</h2>
          <div class="subEn">Result · Ripple</div>
          <p id="confirmDesc">你已完成首發色投票。</p>

          <div class="cardPreview" aria-label="Founder Card 預覽">
            <canvas id="cardCanvas" width="1200" height="750"></canvas>
          </div>

          <div class="resultFooter">HESTIA&nbsp;TAIWAN<span class="reg">&reg;</span></div>

<div class="heat" id="heat"></div>

          <div class="tiny">
            ※ 資料會一併送出：Email + 目前投票色（key / 英文 / 中文）。<br/>
            ※ 每個 Email 僅能投一次，重複、無效的 Email 將不列入統計。<br/>
            ※ 感謝你/妳參與 HESTiA 品牌誕生，我們將很快與大家見面！
          </div>
        </div>
      </div>
    </section>

    <div class="toast" id="toast" aria-live="polite">已送出。</div>
  </div>

  <script>
    // ====== Google Form（保留路徑；不具備「阻擋重複 email」能力）======
    const GOOGLE_FORM_ACTION_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfhd7xkPSuii1u9faP0mQNmF-6tSbDqZIrupyK1_e4w7ZU0pQ/formResponse";
    const ENTRY_EMAIL = "entry.989342676";
    const ENTRY_COLOR = "entry.567761042";

    // ====== Apps Script Web App（可做到「每個 email 只能投一次」）======
    // 若你部署了 Apps Script Web App，填入下列 URL：
    // - UNIQUE_CHECK_ENDPOINT：用於 gate 檢查 email 是否已投過（action=check）
    // - VOTE_ENDPOINT：用於投票提交（action=vote）
    // 若不填，系統會退回只用 localStorage + Google Form 的模式（較弱）
    const UNIQUE_CHECK_ENDPOINT = ""; // e.g. https://script.google.com/macros/s/XXXXX/exec
    const VOTE_ENDPOINT = "";         // e.g. https://script.google.com/macros/s/XXXXX/exec

    const GOOGLE_FORM_PREFILL_BASE = "https://docs.google.com/forms/d/e/1FAIpQLSfmk4ZgMlWpAbFKa6x1JNAq0hwn6kzXtOoB9e9nIbZxsAuNTA/viewform?usp=pp_url";

  const WORLDS = [{"key": "ignition", "en": "IGNITION", "zh": "點燃紅", "h": 8, "sat": 92, "lum": 54, "core_hex": "#F63B1E", "hi_hex": "#FF725C"}, {"key": "momentum", "en": "MOMENTUM", "zh": "動能橙", "h": 28, "sat": 92, "lum": 54, "core_hex": "#F6831E", "hi_hex": "#FFA85C"}, {"key": "ground", "en": "GROUND", "zh": "著地綠", "h": 132, "sat": 78, "lum": 46, "core_hex": "#1AD13E", "hi_hex": "#4CFA6F"}, {"key": "airflow", "en": "AIRFLOW", "zh": "氣流藍", "h": 205, "sat": 88, "lum": 54, "core_hex": "#229BF1", "hi_hex": "#5CBBFF"}, {"key": "pulse", "en": "PULSE", "zh": "脈動紫", "h": 275, "sat": 86, "lum": 52, "core_hex": "#961BEE", "hi_hex": "#BB5CFF"}, {"key": "forge", "en": "FORGE", "zh": "鍛造咖", "h": 28, "sat": 66, "lum": 28, "core_hex": "#774418", "hi_hex": "#E16E09"}];

    // demo heatmap counts（你可改成後台回傳）
    let liveCounts = { ignition:0, momentum:0, ground:0, airflow:0, pulse:0, forge:0 };

    // ====== Live counts source (Google Sheets CSV, read-only) ======
    // 當總票數為 0 時，結果頁會顯示 6 色均分（16.6%）；一旦開始有票數，就顯示真實占比。
    const RESULTS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSSQsxR8NEnvsi2qf5hxQpxYuMfIlBEHibSQJ7Twdjol9LtGIur6_ZgnRxJ3eLVzOebTC2WuCZTsdZC/pub?gid=1298926627&single=true&output=csv";

    function _toNum(v){
      const n = Number(String(v||"").replace(/[^\d.-]/g,""));
      return Number.isFinite(n) ? n : 0;
    }

    function _parseCountsCSV(csv){
      // 預期格式：key,count（可含表頭）
      // ignition,12
      // momentum,9
      const out = { ignition:0, momentum:0, ground:0, airflow:0, pulse:0, forge:0 };
      const text = String(csv||"").trim();
      if(!text) return out;
      const lines = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      for(const line of lines){
        const parts = line.split(",").map(s=>s.trim());
        if(parts.length < 2) continue;
        const key = (parts[0]||"").toLowerCase();
        if(key==="key" || key==="color" || key==="world") continue; // header
        if(Object.prototype.hasOwnProperty.call(out, key)){
          out[key] = _toNum(parts[1]);
        }
      }
      return out;
    }

    async function fetchCountsFromCSV(){
      if(!RESULTS_CSV_URL) return null;
      try{
        const res = await fetch(RESULTS_CSV_URL, { cache:"no-store" });
        if(!res.ok) throw new Error("CSV fetch failed: "+res.status);
        const csv = await res.text();
        return _parseCountsCSV(csv);
      }catch(e){
        console.warn(e);
        return null;
      }
    }

    function applyCountsToResultUI(){
      const sum = Object.values(liveCounts).reduce((a,b)=>a+(Number(b)||0),0);
      const total = sum || 0;
      for(const ww of WORLDS){
        const pctVal = total===0 ? (100/6) : ((liveCounts[ww.key]||0)/total*100);
        const pctText = (Math.round(pctVal*10)/10).toFixed(1) + "%";
        const bar=document.querySelector(`[data-bar="${ww.key}"]`);
        const label=document.querySelector(`[data-pct="${ww.key}"]`);
        if(bar){
          const w = clamp(pctVal, 6, 100); // keep a minimum visual presence
          bar.style.width = w + "%";
        }
        if(label) label.textContent = pctText;
      }
    }

    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
    const clamp = (n,a,b) => Math.max(a, Math.min(b,n));

    function hslToRgb(h,s,l){
      s/=100; l/=100;
      const k = n => (n + h/30) % 12;
      const a = s * Math.min(l, 1-l);
      const f = n => l - a * Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n), 1)));
      return [Math.round(255*f(0)), Math.round(255*f(8)), Math.round(255*f(4))];
    }
    function relativeLuminance([r,g,b]){
      const srgb=[r,g,b].map(v=>v/255).map(v=>v<=0.03928? v/12.92 : Math.pow((v+0.055)/1.055,2.4));
      return 0.2126*srgb[0]+0.7152*srgb[1]+0.0722*srgb[2];
    }

    function vib(ms=18){ if(navigator.vibrate) navigator.vibrate(ms); }
    function getWorld(key){ return WORLDS.find(w=>w.key===key) || WORLDS[0]; }

    // ====== 「真正漸變」的 Tone Transition（h/s/l 插值）======
    let toneRaf = null;
    const toneState = { h: WORLDS[0].h, s: WORLDS[0].sat, l: WORLDS[0].lum };

    function setToneInstant(h,s,l){
      const root=document.documentElement;
      root.style.setProperty("--hue", String(h));
      root.style.setProperty("--sat", String(s) + "%");
      root.style.setProperty("--lum", String(l) + "%");

      const L = relativeLuminance(hslToRgb(h,s,l));
      const lightUI = L > 0.42;
      root.style.setProperty("--uiText", lightUI ? "rgba(0,0,0,.92)" : "rgba(255,255,255,.92)");
      root.style.setProperty("--uiTextMuted", lightUI ? "rgba(0,0,0,.62)" : "rgba(255,255,255,.72)");
      root.style.setProperty("--uiStroke", lightUI ? "rgba(0,0,0,.12)" : "rgba(255,255,255,.14)");
    }

    function lerp(a,b,t){ return a+(b-a)*t; }
    function lerpHue(a,b,t){
      let d = ((b - a + 540) % 360) - 180; // shortest path
      return (a + d * t + 360) % 360;
    }
    function easeOutCubic(t){ return 1 - Math.pow(1-t, 3); }

    function animateTone(toH,toS,toL, dur=720){
      if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
        toneState.h=toH; toneState.s=toS; toneState.l=toL;
        setToneInstant(toH,toS,toL);
        return;
      }
      if (toneRaf) cancelAnimationFrame(toneRaf);
      const fromH=toneState.h, fromS=toneState.s, fromL=toneState.l;
      const t0 = performance.now();

      const step=(t)=>{
        const p = clamp((t - t0)/dur, 0, 1);
        const e = easeOutCubic(p);
        const h = lerpHue(fromH, toH, e);
        const s = lerp(fromS, toS, e);
        const l = lerp(fromL, toL, e);
        setToneInstant(h,s,l);
        if (p < 1) toneRaf = requestAnimationFrame(step);
        else {
          toneRaf = null;
          toneState.h=toH; toneState.s=toS; toneState.l=toL;
        }
      };
      toneRaf = requestAnimationFrame(step);
    }

    function showToast(msg){
      const t=$("#toast");
      t.textContent=msg;
      t.classList.add("on");
      clearTimeout(showToast._tm);
      showToast._tm=setTimeout(()=>t.classList.remove("on"), 1600);
    }

    window.addEventListener("contextmenu",(e)=>e.preventDefault(),{capture:true});

    // ====== One-email-one-vote（前端 localStorage 保護）======
    const LS_EMAIL_KEY = "HESTIA_PRISM_EMAIL";
    const LS_VOTED_KEY = "HESTIA_PRISM_VOTED"; // stores sha256(email) if possible; fallback plain

    async function sha256(str){
      try {
        const buf = new TextEncoder().encode(str);
        const digest = await crypto.subtle.digest("SHA-256", buf);
        const arr = Array.from(new Uint8Array(digest));
        return arr.map(b=>b.toString(16).padStart(2,"0")).join("");
      } catch(e) {
        return btoa(unescape(encodeURIComponent(str))).slice(0,64);
      }
    }

    function validEmail(s){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s); }

    let userEmail = "";
    const gateEmail = $("#gateEmail");
    const gateBtn = $("#gateBtn");
    const gateWarn = $("#gateWarn");

    const monolithStage = $("#monolithStage");
    const spectrum = $("#spectrum");
    const phase = $("#phase");
    const activeChip = $("#activeColorChip");
    const activeName = $("#activeColorName");

    function openSpectrum(){

      try{ document.body.dataset.stage="vote"; }catch(e){}
      try{ if(monolithTimer){ clearInterval(monolithTimer); monolithTimer=null; } }catch(e){}
spectrum.classList.add("is-open");
      monolithStage.style.opacity="0";
      monolithStage.style.pointerEvents="none";
      phase.textContent="SPECTRUM";
      activeChip.style.opacity="1";
      activeChip.style.transform="translateY(0)";

      // Freeze hero color at the moment you enter Vote (guide uses current color)
      try{ if(monolithTimer){ clearInterval(monolithTimer); monolithTimer=null; } }catch(e){}

      spectrum.scrollTop = 0;
      // Calibrate tone immediately on enter (ensure background matches visible Option A without waiting for scroll)
      const calibrateSpectrumTone = () => {
        try{
          const first = spectrum.querySelector(".stall[data-world]");
          if(first && first.dataset && first.dataset.world){
            applyActive(first.dataset.world);
    }
        }catch(e){}
      };
      requestAnimationFrame(()=>requestAnimationFrame(calibrateSpectrumTone));

    }

    async function backendCheckAlreadyVoted(email){
      if(!UNIQUE_CHECK_ENDPOINT) return null; // no backend
      const u = new URL(UNIQUE_CHECK_ENDPOINT);
      u.searchParams.set("action","check");
      u.searchParams.set("email", email);
      const res = await fetch(u.toString(), { method:"POST" });
      const data = await res.json();
      if(!data || !data.ok) return null;
      return !!data.exists;
    }

    async function gateEnter(){
      const v=(gateEmail.value||"").trim().toLowerCase();
      if(!validEmail(v)){
        gateWarn.classList.add("on");
        vib(10);
        showToast("請先輸入有效 Email。");
        gateEmail.focus();
        return;
      }
      gateWarn.classList.remove("on");

      // local check
      const hash = await sha256(v);
      const votedHash = localStorage.getItem(LS_VOTED_KEY);
      if(votedHash && votedHash === hash){
        showToast("此 Email 已參與過投票。");
        vib(18);
        return;
      }

      // optional backend check
      try {
        gateBtn.disabled = true;
        gateBtn.textContent = "檢查中…";
        const exists = await backendCheckAlreadyVoted(v);
        if(exists === true){
          showToast("此 Email 已參與過投票。");
          vib(18);
          return;
        }
      } catch(e) {
        console.warn(e);
        // backend failed: allow proceed but still local-protect
      } finally {
        gateBtn.disabled = false;
        gateBtn.textContent = "進入投票";
      }

      userEmail = v;
      localStorage.setItem(LS_EMAIL_KEY, v);
      openSpectrum();
      showToast("已解鎖投票。");
      vib(18);
    }

    gateBtn.addEventListener("click", gateEnter);
    gateEmail.addEventListener("keydown",(e)=>{ if(e.key==="Enter") gateEnter(); });

    // restore email if exists
    const savedEmail = localStorage.getItem(LS_EMAIL_KEY);
    if(savedEmail) gateEmail.value = savedEmail;

    // ====== 首頻柔和漸變：紅→橙→綠→藍→紫→咖 ======
    let monolithIdx = 0;
    let monolithTimer = null;

    function startMonolithCycle(){
      if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;
      const order = WORLDS; // already in requested order
      // start from current tone
      animateTone(order[0].h, order[0].sat, order[0].lum, 900);
      monolithTimer = setInterval(()=>{
        if (spectrum.classList.contains("is-open")) return; // stop cycling when inside vote
        monolithIdx = (monolithIdx + 1) % order.length;
        const w = order[monolithIdx];
        animateTone(w.h, w.sat, w.lum, 1200); // softer
      }, 1700);
    }

    // ====== Spectrum active color update ======
    let activeKey = WORLDS[0].key;
function applyActive(key){

      if(key==="guide"){ try{ activeKey="guide"; activeName.textContent=""; }catch(e){} return; }
const w=getWorld(key);
      activeKey=key;
      activeName.textContent = w.en;
      animateTone(w.h, w.sat, w.lum, 720);
    }

    const stalls = $$(".stall");
    const io = new IntersectionObserver((entries)=>{
      const visible = entries.filter(e=>e.isIntersecting).sort((a,b)=>b.intersectionRatio-a.intersectionRatio)[0];
      if(!visible) return;
      const key = visible.target.dataset.key;
      if(key && key!==activeKey) applyActive(key);
    }, { root: spectrum, threshold:[0.55,0.65,0.75] });
    stalls.forEach(st=>io.observe(st));

    // ====== Vote / submit ======
    const bloom=$("#bloom");
    const confirm=$("#confirm");

    let holding=false, holdStart=0, holdTimer=null, raf=null, currentSquare=null;

    function pulseBloom(){
      bloom.classList.add("is-on");
      setTimeout(()=>bloom.classList.remove("is-on"), 340);
    }

    function resetHold(){
      holding=false;
      if(currentSquare) currentSquare.classList.remove("is-holding");
      if(currentSquare){
        const fill=currentSquare.querySelector("[data-sq-fill]");
        if(fill) fill.style.width="0%";
        const prog=currentSquare.querySelector(".ringProg");
        if(prog) prog.style.strokeDashoffset = "276.46";
      }
      currentSquare=null;
      if(holdTimer){ clearTimeout(holdTimer); holdTimer=null; }
      if(raf){ cancelAnimationFrame(raf); raf=null; }
    }

    async function postToGoogleForm(payload){
      const fd = new URLSearchParams();
      if(payload.email) fd.append(ENTRY_EMAIL, payload.email);
      if(payload.color) fd.append(ENTRY_COLOR, payload.color);
      await fetch(GOOGLE_FORM_ACTION_URL, {
        method:"POST",
        mode:"no-cors",
        headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},
        body: fd.toString()
      });
    }

    async function postToAppsScriptVote(email, color){
      if(!VOTE_ENDPOINT) return null;
      const u = new URL(VOTE_ENDPOINT);
      u.searchParams.set("action","vote");
      u.searchParams.set("email", email);
      u.searchParams.set("color", color);
      const res = await fetch(u.toString(), { method:"POST" });
      const data = await res.json();
      return data;
    }

    async function submitVoteOnce(key){
      const email = (userEmail||"").trim().toLowerCase();
      if(!email) throw new Error("missing_email");

      const hash = await sha256(email);
      const votedHash = localStorage.getItem(LS_VOTED_KEY);
      if(votedHash && votedHash === hash) {
        const err = new Error("already_voted_local");
        err.code="already_voted";
        throw err;
      }

      const w=getWorld(key);
      const colorValue = `${w.key}|${w.en}|${w.zh}`;

      // 1) Try backend (strong)
      if(VOTE_ENDPOINT){
        const data = await postToAppsScriptVote(email, colorValue);
        if(data && data.ok && data.saved){
          localStorage.setItem(LS_VOTED_KEY, hash);
          return;
        }
        if(data && data.reason === "already_voted"){
          localStorage.setItem(LS_VOTED_KEY, hash);
          const err = new Error("already_voted_backend");
          err.code="already_voted";
          throw err;
        }
        // fallback to google form
      }

      // 2) Always keep Google Form path (weak, cannot block duplicates)
      await postToGoogleForm({ email, color: colorValue });
      localStorage.setItem(LS_VOTED_KEY, hash);
    }

    function startHold(square){
      if(!spectrum.classList.contains("is-open")) return;
      if(!userEmail){ showToast("請先輸入 Email。"); return; }

      const st=square.closest(".stall");
      const key=st?.dataset?.key || activeKey;
      applyActive(key);

      holding=true;
      currentSquare=square;
      currentSquare.classList.add("is-holding");
      const fill=square.querySelector("[data-sq-fill]");
      const ring=square.querySelector(".ringProg");
      holdStart=performance.now();

      vib(10);

      holdTimer=setTimeout(async ()=>{
        vib(28);
        pulseBloom();
        try {
          await submitVoteOnce(key);
          liveCounts[key] = (liveCounts[key]||0)+1;
          setTimeout(()=>showConfirm(key), 420);
        } catch(e) {
          console.warn(e);
          if(e.code==="already_voted") showToast("此 Email 已投過票。");
          else showToast("送出失敗，請稍後再試。");
        }
        resetHold();
      }, 1000);

      let vibCount=0;
      const step=(t)=>{
        const p=clamp((t-holdStart)/1000, 0, 1);
        if(fill) fill.style.width = (p*100).toFixed(1) + "%";
        if(ring) ring.style.strokeDashoffset = String(276.46 * (1-p));

        if(p>0.35 && vibCount<1){ vib(10); vibCount++; }
        if(p>0.60 && vibCount<2){ vib(12); vibCount++; }
        if(p>0.82 && vibCount<3){ vib(16); vibCount++; }
        if(p>0.94 && vibCount<4){ vib(20); vibCount++; }

        if(holding) raf=requestAnimationFrame(step);
      };
      raf=requestAnimationFrame(step);
    }

    function endHold(){ if(!holding) return; resetHold(); }

    $$("[data-charge-square]").forEach(square=>{
      square.addEventListener("pointermove",(e)=>{
        const r=square.getBoundingClientRect();
        const x=((e.clientX-r.left)/r.width)*100;
        const y=((e.clientY-r.top)/r.height)*100;
        square.style.setProperty("--gx", x+"%");
        square.style.setProperty("--gy", y+"%");
      });
      square.addEventListener("pointerdown",(e)=>{
        e.preventDefault();
        square.setPointerCapture?.(e.pointerId);
        startHold(square);
      });
      square.addEventListener("pointerup",(e)=>{ e.preventDefault(); endHold(); });
      square.addEventListener("pointercancel",(e)=>{ e.preventDefault(); endHold(); });
      square.addEventListener("keydown",(e)=>{
        if(e.key==="Enter"||e.key===" "){ e.preventDefault(); startHold(square); }
      });
      square.addEventListener("keyup",(e)=>{
        if(e.key==="Enter"||e.key===" "){ e.preventDefault(); endHold(); }
      });
    });

    // ====== Heatmap + Founder Card (same logic) ======
    function buildHeatmap(){
      const heat=$("#heat");
      heat.innerHTML="";
      for(const w of WORLDS){
        const cell=document.createElement("div");
        cell.className="cell";
        cell.innerHTML=`
          <p class="name">${w.en}</p>
          <div class="bar"><i data-bar="${w.key}"></i></div>
          <div class="pct" data-pct="${w.key}">—%</div>
        `;
        heat.appendChild(cell);
      }
    }
    buildHeatmap();

    const cardCanvas=$("#cardCanvas");
    const ctx=cardCanvas.getContext("2d");

    

    // HLOGO for Founder Card (right-side mark)
    const hlogoImg=new Image();
    hlogoImg.src="HLOGO.png";
const noiseCanvas=document.createElement("canvas");
    noiseCanvas.width=240; noiseCanvas.height=150;
    const nctx=noiseCanvas.getContext("2d");
    const img=nctx.createImageData(noiseCanvas.width, noiseCanvas.height);
    for(let i=0;i<img.data.length;i+=4){
      const v=Math.floor(Math.random()*255);
      img.data[i]=v; img.data[i+1]=v; img.data[i+2]=v; img.data[i+3]=Math.floor(Math.random()*60);
    }
    nctx.putImageData(img,0,0);

    function roundRect(ctx,x,y,w,h,r){
      const rr=Math.min(r,w/2,h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr,y);
      ctx.arcTo(x+w,y,x+w,y+h,rr);
      ctx.arcTo(x+w,y+h,x,y+h,rr);
      ctx.arcTo(x,y+h,x,y,rr);
      ctx.arcTo(x,y,x+w,y,rr);
      ctx.closePath();
    }
    function drawFlame(ctx,cx,cy,s){
      ctx.beginPath();
      ctx.moveTo(cx, cy - s*0.75);
      ctx.bezierCurveTo(cx + s*0.35, cy - s*0.35, cx + s*0.10, cy - s*0.10, cx + s*0.40, cy + s*0.15);
      ctx.bezierCurveTo(cx + s*0.70, cy + s*0.45, cx + s*0.35, cy + s*0.78, cx, cy + s*0.78);
      ctx.bezierCurveTo(cx - s*0.35, cy + s*0.78, cx - s*0.70, cy + s*0.45, cx - s*0.40, cy + s*0.15);
      ctx.bezierCurveTo(cx - s*0.10, cy - s*0.10, cx - s*0.35, cy - s*0.35, cx, cy - s*0.75);
      ctx.closePath();
      ctx.stroke();
    }

    function renderFounderCard(w, serial){
      const W=cardCanvas.width, H=cardCanvas.height;
      ctx.clearRect(0,0,W,H);

      const g=ctx.createLinearGradient(0,0,W,H);
      g.addColorStop(0, w.hi_hex);
      g.addColorStop(0.55, w.core_hex);
      g.addColorStop(1, "#0B0B0C");
      ctx.fillStyle=g;
      ctx.fillRect(0,0,W,H);

      ctx.globalAlpha=0.22;
      ctx.drawImage(noiseCanvas,0,0,W,H);
      ctx.globalAlpha=1;

      ctx.fillStyle="rgba(0,0,0,.18)";
      roundRect(ctx, 64, 64, W-128, H-128, 32);
      ctx.fill();
      ctx.strokeStyle="rgba(255,255,255,.22)";
      ctx.lineWidth=2;
      roundRect(ctx, 64, 64, W-128, H-128, 32);
      ctx.stroke();

      ctx.fillStyle="rgba(255,255,255,.92)";
      ctx.font="800 54px system-ui, -apple-system, 'SF Pro Display'";
      ctx.fillText("FOUNDER", 112, 210);

      ctx.font="650 32px system-ui, -apple-system, 'SF Pro Text'";
      ctx.fillStyle="rgba(255,255,255,.80)";
      ctx.fillText("HESTIA • Tone-on-Tone", 112, 268);

      ctx.font="900 78px system-ui, -apple-system, 'SF Pro Display'";
      ctx.fillStyle="rgba(255,255,255,.94)";
      ctx.fillText(w.en, 112, 390);

      ctx.font="650 32px 'PingFang TC', system-ui";
      ctx.fillStyle="rgba(255,255,255,.80)";
      ctx.fillText(w.zh, 112, 442);

      ctx.font="700 32px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace";
      ctx.fillStyle="rgba(255,255,255,.82)";
      ctx.fillText(`No. ${serial}`, 112, 510);

      ctx.strokeStyle="rgba(255,255,255,.26)";
      ctx.lineWidth=2;
      ctx.beginPath();
      ctx.moveTo(112, 556);
      ctx.lineTo(520, 556);
      ctx.stroke();

      ctx.font="650 26px system-ui, -apple-system, 'SF Pro Text'";
      ctx.fillStyle="rgba(255,255,255,.70)";
      ctx.fillText("Your Spectrum is Set", 112, 612);

      ctx.globalAlpha=.95;
      if(hlogoImg && hlogoImg.complete && hlogoImg.naturalWidth>0){
        const size=180;
        const x=W-64-size-70;
        const y=H/2 - size/2 + 40;
        ctx.drawImage(hlogoImg, x, y, size, size);
      }else{
        ctx.strokeStyle="rgba(255,255,255,.86)";
        ctx.lineWidth=7;
        drawFlame(ctx, W-260, H-280, 140);
      }
      ctx.globalAlpha=1;

      cardCanvas.dataset.serial=serial;
      cardCanvas.dataset.key=w.key;
    }

    function showConfirm(key){
      const w=getWorld(key);
      $("#confirmDesc").textContent = `你投給了「${w.zh}」｜${w.en}。以下是專屬於你/妳的Founder卡。`;

            applyCountsToResultUI();

      // 更新為「全站即時占比」（讀取公開 CSV；失敗則維持目前顯示）
      fetchCountsFromCSV().then((c)=>{ if(c){ liveCounts=c; applyCountsToResultUI(); } });

      const serial=(()=>{const k="hestia_founder_serial"; const cur=parseInt(localStorage.getItem(k)||"4020",10)+1; localStorage.setItem(k,String(cur)); return String(cur).padStart(4,"0");})();
      renderFounderCard(w, serial);

      confirm.classList.add("is-on");
    }

    // Tap backdrop to close (since buttons are removed)
    confirm.addEventListener("click",(e)=>{ if(e.target===confirm){ confirm.classList.remove("is-on"); }});
    setToneInstant(WORLDS[0].h, WORLDS[0].sat, WORLDS[0].lum);
    try{ document.body.dataset.stage="hero"; }catch(e){}
    startMonolithCycle();
  </script>
</body>
</html>
